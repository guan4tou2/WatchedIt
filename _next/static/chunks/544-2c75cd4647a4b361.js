(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{3067:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(2898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6245:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(2898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},2245:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(2898).Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]])},2549:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(2898).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},3181:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var n=r(7437),a=r(2265),i=r(3277),o=r(575),l=r(2549),s=r(9883);function c(e){let{availableTags:t,selectedTags:r,onTagsChange:c,disabled:u=!1}=e,[d,f]=(0,a.useState)(!1),w=e=>{r.some(t=>t.id===e.id)?c(r.filter(t=>t.id!==e.id)):c([...r,e])},g=e=>{c(r.filter(t=>t.id!==e))},h=t.filter(e=>!r.some(t=>t.id===e.id));return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("label",{className:"form-label",children:"標籤"}),r.length>0&&(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(e=>(0,n.jsxs)(i.C,{className:"flex items-center space-x-1",children:[(0,n.jsx)("span",{children:e.name}),!u&&(0,n.jsx)("button",{onClick:()=>g(e.id),className:"ml-1 hover:bg-black hover:bg-opacity-10 rounded-full p-0.5",children:(0,n.jsx)(l.Z,{className:"w-3 h-3"})})]},e.id))}),!u&&(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)(o.z,{type:"button",variant:"outline",size:"sm",onClick:()=>f(!d),className:"w-full justify-start",children:[(0,n.jsx)(s.Z,{className:"w-4 h-4 mr-2"}),0===r.length?"選擇標籤":"管理標籤"]}),d&&(0,n.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dropdown-bg border rounded-md shadow-lg z-10 max-h-48 overflow-y-auto",children:0===h.length?(0,n.jsx)("div",{className:"p-3 text-sm empty-state text-center",children:"所有標籤都已選擇"}):(0,n.jsx)("div",{className:"p-2 space-y-1",children:h.map(e=>(0,n.jsxs)("button",{onClick:()=>w(e),className:"w-full text-left p-2 hover:bg-gray-50 hover-bg rounded flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-4 h-4 rounded border"}),(0,n.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})})]}),d&&(0,n.jsx)("div",{className:"fixed inset-0 z-0",onClick:()=>f(!1)})]})}},3536:function(e,t,r){"use strict";r.d(t,{B:function(){return i}});var n=r(4660),a=r(5809);let i=(0,n.Ue)((e,t)=>({works:[],tags:[],stats:null,loading:!1,error:null,initialize:async()=>{try{await a.we.init(),await a.IL.init();let t=await a.we.getAll();0===t.length&&await (0,a.W0)();let r=await a.we.getAll(),n=await a.IL.getAll(),i=await a.we.getStats();e({works:r,tags:n,stats:i})}catch(t){console.error("初始化失敗:",t),e({error:"初始化失敗"})}},fetchWorks:async t=>{e({loading:!0,error:null});try{let r=await a.we.getList(t);return e({works:r.works,loading:!1}),r}catch(t){throw e({error:t instanceof Error?t.message:"取得作品列表失敗",loading:!1}),t}},createWork:async t=>{e({loading:!0,error:null});try{if(await a.we.findByTitle(t.title))throw Error("作品「".concat(t.title,"」已存在於您的收藏中！"));if("AniList"===t.source&&t.note){let e=t.note.match(/AniList ID: (\d+)/);if(e){let r=parseInt(e[1]);if(await a.we.findByAniListId(r))throw Error("作品「".concat(t.title,"」已存在於您的收藏中！"))}}let r=await a.we.create(t),n=await a.we.getAll(),i=await a.we.getStats();return e({works:n,stats:i,loading:!1}),r}catch(t){throw e({error:t instanceof Error?t.message:"新增作品失敗",loading:!1}),t}},updateWork:async(t,r)=>{e({loading:!0,error:null});try{let n=await a.we.update(t,r);if(!n)throw Error("作品不存在");let i=await a.we.getAll(),o=await a.we.getStats();return e({works:i,stats:o,loading:!1}),n}catch(t){throw e({error:t instanceof Error?t.message:"更新作品失敗",loading:!1}),t}},deleteWork:async t=>{e({loading:!0,error:null});try{if(!await a.we.delete(t))throw Error("作品不存在");let r=await a.we.getAll(),n=await a.we.getStats();return e({works:r,stats:n,loading:!1}),!0}catch(t){throw e({error:t instanceof Error?t.message:"刪除作品失敗",loading:!1}),t}},getWork:async e=>{try{return(await a.we.getAll()).find(t=>t.id===e)||null}catch(e){return console.error("取得作品失敗:",e),null}},updateWorks:async t=>{try{await a.we.setAll(t),e({works:t})}catch(e){console.error("更新作品失敗:",e)}},fetchTags:async()=>{e({loading:!0,error:null});try{let t=await a.IL.getAll();return e({tags:t,loading:!1}),t}catch(t){throw e({error:t instanceof Error?t.message:"取得標籤列表失敗",loading:!1}),t}},createTag:async t=>{e({loading:!0,error:null});try{let r=await a.IL.create(t),n=await a.IL.getAll();return e({tags:n,loading:!1}),r}catch(t){throw e({error:t instanceof Error?t.message:"新增標籤失敗",loading:!1}),t}},updateTag:async(t,r)=>{e({loading:!0,error:null});try{let n=await a.IL.update(t,r);if(!n)throw Error("標籤不存在");let i=await a.IL.getAll();return e({tags:i,loading:!1}),n}catch(t){throw e({error:t instanceof Error?t.message:"更新標籤失敗",loading:!1}),t}},deleteTag:async t=>{e({loading:!0,error:null});try{if(!await a.IL.delete(t))throw Error("標籤不存在");let r=await a.IL.getAll();return e({tags:r,loading:!1}),!0}catch(t){throw e({error:t instanceof Error?t.message:"刪除標籤失敗",loading:!1}),t}},updateTags:async t=>{try{await a.IL.setAll(t),e({tags:t})}catch(e){console.error("更新標籤失敗:",e)}},fetchStats:async()=>{e({loading:!0,error:null});try{let t=await a.we.getStats();return e({stats:t,loading:!1}),t}catch(t){throw e({error:t instanceof Error?t.message:"取得統計數據失敗",loading:!1}),t}}}))},4033:function(e,t,r){e.exports=r(5313)},9808:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=n.useState,o=n.useEffect,l=n.useLayoutEffect,s=n.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=i({inst:{value:r,getSnapshot:t}}),a=n[0].inst,u=n[1];return l(function(){a.value=r,a.getSnapshot=t,c(a)&&u({inst:a})},[e,r,t]),o(function(){return c(a)&&u({inst:a}),e(function(){c(a)&&u({inst:a})})},[e]),s(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:u},3176:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(2265),a=r(6272),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=a.useSyncExternalStore,l=n.useRef,s=n.useEffect,c=n.useMemo,u=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,n,a){var d=l(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;var w=o(e,(d=c(function(){function e(e){if(!s){if(s=!0,o=e,e=n(e),void 0!==a&&f.hasValue){var t=f.value;if(a(t,e))return l=t}return l=e}if(t=l,i(o,e))return t;var r=n(e);return void 0!==a&&a(t,r)?(o=e,t):(o=e,l=r)}var o,l,s=!1,c=void 0===r?null:r;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,r,n,a]))[0],d[1]);return s(function(){f.hasValue=!0,f.value=w},[w]),u(w),w}},6272:function(e,t,r){"use strict";e.exports=r(9808)},5401:function(e,t,r){"use strict";e.exports=r(3176)},4660:function(e,t,r){"use strict";r.d(t,{Ue:function(){return f}});let n=e=>{let t;let r=new Set,n=(e,n)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=n?n:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:n,getState:a,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},o=t=e(n,a,i);return i},a=e=>e?n(e):n;var i=r(2265),o=r(5401);let{useDebugValue:l}=i,{useSyncExternalStoreWithSelector:s}=o,c=!1,u=e=>e,d=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?a(e):e,r=(e,r)=>(function(e,t=u,r){r&&!c&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),c=!0);let n=s(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return l(n),n})(t,e,r);return Object.assign(r,t),r},f=e=>e?d(e):d}}]);