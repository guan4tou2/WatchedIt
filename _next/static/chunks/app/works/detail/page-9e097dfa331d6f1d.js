(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{8203:function(e,s,l){"use strict";l.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,l(2898).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},3673:function(e,s,l){"use strict";l.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,l(2898).Z)("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]])},7528:function(e,s,l){Promise.resolve().then(l.bind(l,9253))},9253:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return w}});var a=l(7437),t=l(2265),i=l(4033),r=l(5671),n=l(575),c=l(3277),d=l(3536),x=l(170),o=l(2782),m=l(3181),h=l(2245),j=l(6245),u=l(2549);function p(e){let{work:s,onSave:l,onCancel:i,isOpen:c,inline:x=!1}=e,{tags:p}=(0,d.B)(),[v,N]=(0,t.useState)({title:s.title,type:s.type,status:s.status,year:s.year||"",rating:s.rating||"",review:s.review||"",note:s.note||"",source:s.source||""}),[g,f]=(0,t.useState)(s.tags||[]);(0,t.useEffect)(()=>{N({title:s.title,type:s.type,status:s.status,year:s.year||"",rating:s.rating||"",review:s.review||"",note:s.note||"",source:s.source||""}),f(s.tags||[])},[s]);let b=e=>{N({...v,rating:v.rating===e.toString()?"":e.toString()})};if(!c)return null;let y=(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l({title:v.title,type:v.type,status:v.status,year:v.year?parseInt(v.year.toString()):void 0,rating:v.rating?parseInt(v.rating.toString()):void 0,review:v.review||void 0,note:v.note||void 0,source:v.source||void 0,tags:g})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"標題"}),(0,a.jsx)(o.I,{value:v.title,onChange:e=>N({...v,title:e.target.value}),placeholder:"作品標題",required:!0,className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"類型"}),(0,a.jsxs)("select",{value:v.type,onChange:e=>N({...v,type:e.target.value}),className:"w-full mt-1 p-2 border rounded-md form-select",required:!0,children:[(0,a.jsx)("option",{value:"動畫",children:"動畫"}),(0,a.jsx)("option",{value:"電影",children:"電影"}),(0,a.jsx)("option",{value:"電視劇",children:"電視劇"}),(0,a.jsx)("option",{value:"小說",children:"小說"}),(0,a.jsx)("option",{value:"漫畫",children:"漫畫"}),(0,a.jsx)("option",{value:"遊戲",children:"遊戲"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"狀態"}),(0,a.jsxs)("select",{value:v.status,onChange:e=>N({...v,status:e.target.value}),className:"w-full mt-1 p-2 border rounded-md form-select",required:!0,children:[(0,a.jsx)("option",{value:"進行中",children:"進行中"}),(0,a.jsx)("option",{value:"已完結",children:"已完結"}),(0,a.jsx)("option",{value:"暫停",children:"暫停"}),(0,a.jsx)("option",{value:"放棄",children:"放棄"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"年份"}),(0,a.jsx)(o.I,{type:"number",value:v.year,onChange:e=>N({...v,year:e.target.value}),placeholder:"2023",min:"1900",max:"2030",className:"mt-1"})]})]}),(0,a.jsx)(m.Z,{availableTags:p,selectedTags:g,onTagsChange:f}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"評分"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[[1,2,3,4,5].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>b(e),className:"p-2 rounded-md transition-colors ".concat(parseInt(String(v.rating||"0"))>=e?"star-icon bg-yellow-50 dark:bg-yellow-900/20":"star-icon-unselected"),children:(0,a.jsx)(h.Z,{className:"w-5 h-5",fill:parseInt(String(v.rating||"0"))>=e?"currentColor":"none"})},e)),v.rating&&(0,a.jsxs)("span",{className:"text-sm description-text ml-2",children:[v.rating,"/5"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"評論"}),(0,a.jsx)("textarea",{value:v.review,onChange:e=>N({...v,review:e.target.value}),placeholder:"分享您的觀後感...",rows:3,className:"w-full mt-1 p-2 border rounded-md resize-none form-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"備註"}),(0,a.jsx)("textarea",{value:v.note,onChange:e=>N({...v,note:e.target.value}),placeholder:"其他備註...",rows:2,className:"w-full mt-1 p-2 border rounded-md resize-none form-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"來源"}),(0,a.jsx)(o.I,{value:v.source,onChange:e=>N({...v,source:e.target.value}),placeholder:"作品來源",className:"mt-1"})]}),(0,a.jsxs)("div",{className:"flex space-x-2 pt-4",children:[(0,a.jsxs)(n.z,{type:"submit",className:"flex-1",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"儲存"]}),(0,a.jsxs)(n.z,{type:"button",variant:"outline",onClick:i,className:"flex-1",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"取消"]})]})]});return x?y:(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsx)(r.ll,{children:"編輯作品"})}),(0,a.jsx)(r.aY,{children:y})]})}var v=l(2169),N=l(3067),g=l(1138),f=l(9617),b=l(8203),y=l(3673);function w(){let e=(0,i.useRouter)(),s=(0,i.useSearchParams)(),{getWork:l,updateWork:o,deleteWork:m,loading:h}=(0,d.B)(),[j,u]=(0,t.useState)(null),[w,k]=(0,t.useState)(!1),[C,S]=(0,t.useState)(!1),[Z,z]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{let e=null==s?void 0:s.get("id");if(e){z(!0);try{let s=await l(e);u(s)}catch(e){console.error("載入作品失敗:",e)}finally{z(!1)}}})()},[s,l]);let _=async()=>{j&&confirm("確定要刪除這個作品嗎？")&&(await m(j.id),e.push((0,v.a)("/")))};if(h||Z)return(0,a.jsx)("div",{className:"container mx-auto p-4 sm:p-6",children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:"載入中..."})]})})});if(!j)return(0,a.jsx)("div",{className:"container mx-auto p-4 sm:p-6",children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"作品不存在"}),(0,a.jsxs)(n.z,{variant:"outline",onClick:()=>e.push((0,v.a)("/")),children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"返回首頁"]})]})})});let D=j.episodes||[],O=D.filter(e=>e.watched).length,I=D.length;return(0,a.jsxs)("div",{className:"container mx-auto p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>e.back(),children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"返回"]}),(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:j.title})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:_,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"刪除"]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-4 sm:space-y-6",children:[(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-2 sm:space-y-0",children:[(0,a.jsx)(r.ll,{children:"基本資訊"}),(0,a.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>S(!C),children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),C?"取消編輯":"編輯作品"]})]})}),(0,a.jsxs)(r.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"類型"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(c.C,{variant:"secondary",children:j.type})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"狀態"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(c.C,{variant:"已完結"===j.status?"default":"進行中"===j.status?"secondary":"outline",children:j.status})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"年份"}),(0,a.jsx)("p",{className:"mt-1 title-text",children:j.year||"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"評分"}),(0,a.jsx)("p",{className:"mt-1 title-text",children:j.rating?"".concat(j.rating,"/5"):"未評分"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"form-label flex items-center",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-1"}),"新增時間"]}),(0,a.jsx)("p",{className:"mt-1 title-text",children:new Date(j.date_added).toLocaleDateString("zh-TW")})]}),j.date_updated&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"更新時間"}),(0,a.jsx)("p",{className:"mt-1 title-text",children:new Date(j.date_updated).toLocaleDateString("zh-TW")})]})]}),j.review&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"評論"}),(0,a.jsx)("p",{className:"mt-1 description-text",children:j.review})]}),j.note&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"備註"}),(0,a.jsx)("p",{className:"mt-1 description-text",children:j.note})]}),j.source&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"來源"}),(0,a.jsx)("p",{className:"mt-1 description-text",children:j.source})]}),j.tags&&j.tags.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 flex items-center",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-1"}),"標籤"]}),(0,a.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:j.tags.map(e=>(0,a.jsx)(c.C,{children:e.name},e.id))})]}),C&&j&&(0,a.jsx)("div",{className:"mt-6 p-4 border-2 border-dashed border-blue-200 dark:border-blue-800 rounded-lg",children:(0,a.jsx)(p,{work:j,onSave:e=>{j&&(u({...j,...e,date_updated:new Date().toISOString()}),o(j.id,e),S(!1))},onCancel:()=>S(!1),isOpen:!0,inline:!0})})]})]}),(0,a.jsx)(x.Z,{episodes:D,onEpisodesChange:e=>{if(j)try{console.log("處理集數變更:",e);let s={...j,episodes:e,date_updated:new Date().toISOString()};console.log("更新作品:",s),u(s),o(j.id,{episodes:e})}catch(e){console.error("處理集數變更失敗:",e)}},type:j.type,disabled:!1,isEditing:w,onToggleEditing:()=>k(!w)})]}),(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsx)(r.ll,{children:"集數統計"})}),(0,a.jsxs)(r.aY,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-semibold title-text",children:I}),(0,a.jsx)("div",{className:"description-text",children:"總集數"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-semibold title-text",children:O}),(0,a.jsx)("div",{className:"description-text",children:"季數"})]})]}),D.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium title-text",children:"集數類型"}),(0,a.jsx)("div",{className:"space-y-1",children:Object.entries(D.reduce((e,s)=>(e[s.type]=(e[s.type]||0)+1,e),{})).map(e=>{let[s,l]=e;return(0,a.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,a.jsx)("span",{className:"capitalize subtitle-text",children:s}),(0,a.jsx)("span",{className:"title-text",children:l})]},s)})})]})]})]}),(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsx)(r.ll,{children:"時間資訊"})}),(0,a.jsxs)(r.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm description-text",children:"新增時間"}),(0,a.jsx)("span",{className:"text-sm title-text",children:new Date(j.date_added).toLocaleDateString("zh-TW")})]}),j.date_updated&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm description-text",children:"更新時間"}),(0,a.jsx)("span",{className:"text-sm title-text",children:new Date(j.date_updated).toLocaleDateString("zh-TW")})]})]})]})]})]})]})}}},function(e){e.O(0,[621,330,170,544,971,458,744],function(){return e(e.s=7528)}),_N_E=e.O()}]);