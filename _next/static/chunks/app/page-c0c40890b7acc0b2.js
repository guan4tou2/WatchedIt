(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9488:function(e,s,t){Promise.resolve().then(t.bind(t,4889))},4889:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return X}});var a=t(7437),l=t(2265),r=t(3536),n=t(5671),i=t(575),c=t(2782),d=t(3277),o=t(5343),m=t(954),x=t(2169),u=t(5809);async function h(){try{await u.we.init(),await u.IL.init();let e=await u.we.getAll(),s=await u.IL.getAll();if(e.length>0||s.length>0)return{success:!1,message:"IndexedDB 已有數據，無法遷移",migratedWorks:0,migratedTags:0};let{works:t,tags:a}=function(){try{let e=localStorage.getItem("watchedit_works"),s=localStorage.getItem("watchedit_tags"),t=e?JSON.parse(e):[],a=s?JSON.parse(s):[];return{works:t,tags:a}}catch(e){return console.error("讀取 localStorage 數據失敗:",e),{works:[],tags:[]}}}();if(0===t.length&&0===a.length)return{success:!1,message:"沒有找到需要遷移的數據",migratedWorks:0,migratedTags:0};let l=0;for(let e of t)try{await u.we.create(e),l++}catch(s){console.error("遷移作品失敗: ".concat(e.title),s)}let r=0;for(let e of a)try{await u.IL.create(e),r++}catch(s){console.error("遷移標籤失敗: ".concat(e.name),s)}return{success:!0,message:"遷移完成！成功遷移 ".concat(l," 個作品和 ").concat(r," 個標籤"),migratedWorks:l,migratedTags:r}}catch(e){return console.error("遷移失敗:",e),{success:!1,message:"遷移失敗: ".concat(e instanceof Error?e.message:"未知錯誤"),migratedWorks:0,migratedTags:0}}}async function f(){try{let e=function(){try{let e=localStorage.getItem("watchedit_works"),s=localStorage.getItem("watchedit_tags");return!!(e||s)}catch(e){return!1}}();await u.we.init();let s=await u.we.getAll(),t=await u.IL.getAll(),a=s.length>0||t.length>0;return{needsMigration:e&&!a,hasLocalData:e,hasIndexedDBData:a}}catch(e){return console.error("檢查遷移狀態失敗:",e),{needsMigration:!1,hasLocalData:!1,hasIndexedDBData:!1}}}var p=t(1396),g=t.n(p),j=t(1827),b=t(9409),w=t(9883),N=t(8004),v=t(2482),y=t(2549),k=t(2894),C=t(8291),Z=t(2245),S=t(8203),z=t(4900),I=t(4222),_=t(6096),T=t(2442);function O(e){var s;let{workId:t,workTitle:r,workType:o,currentEpisodes:m,onEpisodeAdded:x,onBatchEpisodesAdded:u,onClose:h}=e,[f,p]=(0,l.useState)(["episode"]),[g,j]=(0,l.useState)("episode"),[b,w]=(0,l.useState)({}),[N,v]=(0,l.useState)({number:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(0===m.length)return 1;let s=m.filter(s=>s.season===e);return 0===s.length?1:Math.max(...s.map(e=>e.number))+1}(1),title:"",description:"",type:"episode",season:m.length>0&&(null===(s=m[0])||void 0===s?void 0:s.season)||1,note:""}),[k,C]=(0,l.useState)(1);(0,l.useEffect)(()=>{try{let e=I.u.getEpisodeTypesForWorkType(o),s=I.u.getDefaultEpisodeTypeForWorkType(o);p(e),j(s),v(e=>({...e,type:s}));let t=_.e.getTypeLabels();w(t)}catch(e){console.error("載入集數類型失敗:",e),p(["episode"]),j("episode")}},[o]);let Z=e=>b[e]||e,S=e=>{let s=_.e.getByName(e);if(s)return"bg-[".concat(s.color,"]/10 text-[").concat(s.color,"]");switch(e){case"episode":return"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200";case"special":return"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200";case"ova":return"bg-purple-100 dark:bg-purple-900/20 text-purple-800 dark:text-purple-200";case"movie":return"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200";case"chapter":return"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200";default:return"bg-gray-100 dark:bg-gray-900/20 text-gray-800 dark:text-gray-200"}},z=()=>"episode-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(n.Zb,{className:"w-full max-w-md mx-4 bg-white dark:bg-gray-800 shadow-xl",children:[(0,a.jsxs)(n.Ol,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(n.ll,{className:"text-lg title-text",children:"快速新增集數"}),(0,a.jsx)(i.z,{variant:"ghost",size:"sm",onClick:h,children:(0,a.jsx)(y.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("p",{className:"text-sm description-text",children:["為「",r,"」新增集數"]})]}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"開始集數"}),(0,a.jsx)(c.I,{type:"number",min:"1",value:N.number,onChange:e=>v({...N,number:parseInt(e.target.value)||1}),className:"mt-1 form-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"季數"}),(0,a.jsx)(c.I,{type:"number",min:"1",value:N.season,onChange:e=>v({...N,season:parseInt(e.target.value)||1}),className:"mt-1 form-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"新增數量"}),(0,a.jsx)(c.I,{type:"number",min:"1",max:"10",value:k,onChange:e=>C(Math.max(1,Math.min(10,parseInt(e.target.value)||1))),className:"mt-1 form-input"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"標題"}),(0,a.jsx)(c.I,{value:N.title,onChange:e=>v({...N,title:e.target.value}),placeholder:"可選",className:"mt-1 form-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"描述"}),(0,a.jsx)(c.I,{value:N.description,onChange:e=>v({...N,description:e.target.value}),placeholder:"可選",className:"mt-1 form-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"類型"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:f.map(e=>(0,a.jsx)(d.C,{className:"cursor-pointer ".concat(N.type===e?S(e):"badge-unselected"),onClick:()=>v({...N,type:e}),children:Z(e)},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"備註"}),(0,a.jsx)(c.I,{value:N.note,onChange:e=>v({...N,note:e.target.value}),placeholder:"可選",className:"mt-1 form-input"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(i.z,{onClick:()=>{if(!N.number)return;let e=[];for(let s=0;s<k;s++){let t={id:z(),number:N.number+s,title:N.title?"".concat(N.title," ").concat(s>0?"(".concat(s+1,")"):""):void 0,description:N.description||void 0,type:N.type,season:N.season,watched:!0,date_watched:new Date().toISOString(),note:N.note||void 0};e.push(t)}u&&e.length>1?u(e):e.forEach(e=>{x(e)}),h()},className:"flex-1",children:[(0,a.jsx)(T.Z,{className:"w-4 h-4 mr-1"}),"新增 ",k," 集"]}),(0,a.jsx)(i.z,{variant:"outline",onClick:h,className:"flex-1",children:"取消"})]})]})]})})}var E=t(5951),L=t(4135),A=t(3088),D=t(612),R=t(2223),Y=t(7158),M=t(6369);let W=R.fC,B=R.xz;R.ZA,R.Uv,R.Tr,R.Ee,l.forwardRef((e,s)=>{let{className:t,inset:l,children:r,...n}=e;return(0,a.jsxs)(R.fF,{ref:s,className:(0,x.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",l&&"pl-8",t),...n,children:[r,(0,a.jsx)(Y.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=R.fF.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(R.tu,{ref:s,className:(0,x.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})}).displayName=R.tu.displayName;let F=l.forwardRef((e,s)=>{let{className:t,sideOffset:l=4,...r}=e;return(0,a.jsx)(R.Uv,{children:(0,a.jsx)(R.VY,{ref:s,sideOffset:l,className:(0,x.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})})});F.displayName=R.VY.displayName;let U=l.forwardRef((e,s)=>{let{className:t,inset:l,...r}=e;return(0,a.jsx)(R.ck,{ref:s,className:(0,x.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l&&"pl-8",t),...r})});U.displayName=R.ck.displayName,l.forwardRef((e,s)=>{let{className:t,children:l,checked:r,...n}=e;return(0,a.jsxs)(R.oC,{ref:s,className:(0,x.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(R.wU,{children:(0,a.jsx)(T.Z,{className:"h-4 w-4"})})}),l]})}).displayName=R.oC.displayName,l.forwardRef((e,s)=>{let{className:t,children:l,...r}=e;return(0,a.jsxs)(R.Rk,{ref:s,className:(0,x.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(R.wU,{children:(0,a.jsx)(M.Z,{className:"h-2 w-2 fill-current"})})}),l]})}).displayName=R.Rk.displayName,l.forwardRef((e,s)=>{let{className:t,inset:l,...r}=e;return(0,a.jsx)(R.__,{ref:s,className:(0,x.cn)("px-2 py-1.5 text-sm font-semibold",l&&"pl-8",t),...r})}).displayName=R.__.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(R.Z0,{ref:s,className:(0,x.cn)("-mx-1 my-1 h-px bg-muted",t),...l})}).displayName=R.Z0.displayName;var J=t(3397);function P(){let{theme:e,setTheme:s,resolvedTheme:t}=(0,J.useTheme)();return(0,a.jsxs)(W,{children:[(0,a.jsx)(B,{asChild:!0,children:(0,a.jsxs)(i.z,{variant:"outline",size:"icon",children:[(0,a.jsx)(L.Z,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,a.jsx)(A.Z,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,a.jsx)("span",{className:"sr-only",children:"切換主題"})]})}),(0,a.jsxs)(F,{align:"end",children:[(0,a.jsxs)(U,{onClick:()=>s("light"),children:[(0,a.jsx)(L.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"淺色"})]}),(0,a.jsxs)(U,{onClick:()=>s("dark"),children:[(0,a.jsx)(A.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"深色"})]}),(0,a.jsxs)(U,{onClick:()=>s("auto"),children:[(0,a.jsx)(D.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"自動"})]})]})]})}var V=t(5125),q=t(3423),G=t(6141),H=t(4280),K=t(3008);function Q(){let{works:e,tags:s,updateWorks:t,updateTags:c}=(0,r.B)(),[o,m]=(0,l.useState)(!1),[x,u]=(0,l.useState)(null),[h,f]=(0,l.useState)(!1);(0,l.useEffect)(()=>{u(V.a.getLastSyncTime()),f(V.a.shouldSync())},[]);let p=async()=>{let a=V.a.getConfig();if(!(null==a?void 0:a.endpoint)){alert("請先在設定中配置雲端端點");return}m(!0);try{let a=await V.a.syncData(e,s);a.success&&a.data?(t(a.data.works),c(a.data.tags),V.a.setLastSyncTime(),u(new Date().toISOString()),f(!1),alert("同步成功！")):alert("同步失敗: ".concat(a.message))}catch(e){alert("同步失敗")}finally{m(!1)}},g=V.a.getConfig();return(null==g?void 0:g.endpoint)?(0,a.jsxs)(n.Zb,{className:"mb-6",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(q.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"雲端同步"}),h&&(0,a.jsx)(d.C,{variant:"destructive",className:"ml-2",children:"需要同步"})]})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 note-text"}),(0,a.jsxs)("span",{className:"text-sm description-text",children:["最後同步:"," ",x?new Date(x).toLocaleString("zh-TW"):"從未同步"]})]}),(0,a.jsxs)(i.z,{size:"sm",onClick:p,disabled:o,variant:h?"default":"outline",children:[(0,a.jsx)(H.Z,{className:"w-4 h-4 mr-2 ".concat(o?"animate-spin":"")}),o?"同步中...":"立即同步"]})]}),h&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-orange-600 text-sm",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"建議進行同步以確保數據最新"})]}),!h&&x&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-green-600 text-sm",children:[(0,a.jsx)(K.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"數據已是最新狀態"})]})]})]}):null}function X(){var e;let{works:s,stats:t,loading:u,error:p,initialize:I,fetchWorks:_,fetchStats:T,updateWork:L,createWork:A}=(0,r.B)(),[D,R]=(0,l.useState)(null),[Y,M]=(0,l.useState)(!1),[W,B]=(0,l.useState)(""),[F,U]=(0,l.useState)(""),[J,V]=(0,l.useState)(""),[q,G]=(0,l.useState)(""),[H,K]=(0,l.useState)(!1),[X,$]=(0,l.useState)(null),[ee,es]=(0,l.useState)(!1),[et,ea]=(0,l.useState)(!1);(0,l.useEffect)(()=>{el(),I(),_(),T(),m.O.registerServiceWorker()},[I,_,T]);let el=async()=>{try{let e=await f();$(e)}catch(e){console.error("檢查遷移狀態失敗:",e)}},er=async()=>{es(!0);try{let e=await h();e.success?(!function(){try{localStorage.removeItem("watchedit_works"),localStorage.removeItem("watchedit_tags"),console.log("localStorage 數據已清理")}catch(e){console.error("清理 localStorage 失敗:",e)}}(),await I(),await _(),await T(),await el(),alert(e.message)):alert("遷移失敗: ".concat(e.message))}catch(e){console.error("遷移失敗:",e),alert("遷移失敗，請檢查控制台錯誤信息")}finally{es(!1)}},en=(e,s,t)=>{R({workId:e,workTitle:s,workType:t})},ei=async e=>{var t;if(!D)return;let a=s.find(e=>e.id===D.workId);if(!a)return;if(null===(t=a.episodes)||void 0===t?void 0:t.find(s=>s.season===e.season&&s.number===e.number)){console.warn("集數已存在: 第".concat(e.season,"季第").concat(e.number,"集"));return}let l=[...a.episodes||[],e].sort((e,s)=>e.season!==s.season?e.season-s.season:e.number-s.number);await L(a.id,{episodes:l})},ec=s.filter(e=>{var s,t,a;if(W){let s=W.toLowerCase(),l=e.title.toLowerCase().includes(s),r=(null===(t=e.review)||void 0===t?void 0:t.toLowerCase().includes(s))||!1,n=(null===(a=e.note)||void 0===a?void 0:a.toLowerCase().includes(s))||!1;if(!l&&!r&&!n)return!1}return(!F||e.type===F)&&(!J||e.status===J)&&(!q||(null===(s=e.year)||void 0===s?void 0:s.toString())===q)}),ed=()=>{B(""),U(""),V(""),G("")},eo=Array.from(new Set(s.map(e=>e.type))),em=Array.from(new Set(s.map(e=>e.status))),ex=Array.from(new Set(s.map(e=>e.year).filter(e=>void 0!==e))).sort((e,s)=>s-e),eu=e=>{switch(e){case"進行中":return"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200";case"已完結":return"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200";case"暫停":return"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200";case"放棄":return"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200";default:return"badge-unselected"}},eh=e=>{switch(e){case"動畫":return"bg-purple-100 dark:bg-purple-900/20 text-purple-800 dark:text-purple-200";case"電影":return"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200";case"電視劇":return"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200";case"小說":return"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200";case"漫畫":return"bg-orange-100 dark:bg-orange-900/20 text-orange-800 dark:text-orange-200";case"遊戲":return"bg-pink-100 dark:bg-pink-900/20 text-pink-800 dark:text-pink-200";default:return"badge-unselected"}};return u?(0,a.jsx)("div",{className:"container mx-auto p-6",children:(0,a.jsx)("div",{className:"text-center",children:"載入中..."})}):p?(0,a.jsx)("div",{className:"container mx-auto p-6",children:(0,a.jsxs)("div",{className:"bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-4 py-3 rounded",children:["錯誤: ",p]})}):(0,a.jsxs)("div",{className:"container mx-auto p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)(o.Z,{}),(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-2",children:[(0,a.jsx)(P,{}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>M(!0),children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-1"}),"搜尋動畫"]}),(0,a.jsx)(g(),{href:(0,x.a)("/settings"),children:(0,a.jsxs)(i.z,{variant:"outline",size:"sm",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-1"}),"設定"]})}),(0,a.jsx)(g(),{href:(0,x.a)("/works/new"),children:(0,a.jsxs)(i.z,{children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 mr-2"}),"新增作品"]})})]}),(0,a.jsx)("div",{className:"md:hidden",children:(0,a.jsx)(i.z,{variant:"outline",size:"sm",onClick:()=>ea(!et),children:(0,a.jsx)(N.Z,{className:"w-4 h-4"})})})]}),et&&(0,a.jsx)("div",{className:"md:hidden mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg border shadow-lg",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(P,{}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>{M(!0),ea(!1)},children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-1"}),"搜尋動畫"]}),(0,a.jsx)(g(),{href:(0,x.a)("/settings"),children:(0,a.jsxs)(i.z,{variant:"outline",size:"sm",className:"w-full",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-1"}),"設定"]})}),(0,a.jsx)(g(),{href:(0,x.a)("/works/new"),children:(0,a.jsxs)(i.z,{className:"w-full",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 mr-2"}),"新增作品"]})})]})}),t&&(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-6",children:[(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:(0,a.jsx)(n.ll,{className:"text-xs sm:text-sm font-medium",children:"總作品數"})}),(0,a.jsx)(n.aY,{children:(0,a.jsx)("div",{className:"text-lg sm:text-2xl font-bold text-foreground/90 dark:text-foreground/98",children:t.total_works})})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:(0,a.jsx)(n.ll,{className:"text-xs sm:text-sm font-medium",children:"進行中"})}),(0,a.jsx)(n.aY,{children:(0,a.jsx)("div",{className:"text-lg sm:text-2xl font-bold text-foreground/90 dark:text-foreground/98",children:t.status_stats["進行中"]||0})})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:(0,a.jsx)(n.ll,{className:"text-xs sm:text-sm font-medium",children:"已完結"})}),(0,a.jsx)(n.aY,{children:(0,a.jsx)("div",{className:"text-lg sm:text-2xl font-bold text-foreground/90 dark:text-foreground/98",children:t.status_stats["已完結"]||0})})]})]}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(j.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 status-text-muted w-4 h-4"}),(0,a.jsx)(c.I,{placeholder:"搜尋作品標題、評論或備註...",value:W,onChange:e=>B(e.target.value),className:"pl-10"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>K(!H),className:"flex-1 sm:flex-none",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"篩選"})]}),(W||F||J||q)&&(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:ed,children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"清除"})]})]})]}),H&&(0,a.jsx)(n.Zb,{children:(0,a.jsx)(n.aY,{className:"pt-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium form-label",children:"類型"}),(0,a.jsxs)("select",{value:F,onChange:e=>U(e.target.value),className:"w-full mt-1 p-2 border border-input/60 rounded-md text-sm bg-background/95 dark:text-foreground/95",children:[(0,a.jsx)("option",{value:"",children:"全部類型"}),eo.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium form-label",children:"狀態"}),(0,a.jsxs)("select",{value:J,onChange:e=>V(e.target.value),className:"w-full mt-1 p-2 border border-input/60 rounded-md text-sm bg-background/95 dark:text-foreground/95",children:[(0,a.jsx)("option",{value:"",children:"全部狀態"}),em.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium form-label-secondary",children:"年份"}),(0,a.jsxs)("select",{value:q,onChange:e=>G(e.target.value),className:"w-full mt-1 p-2 border rounded-md text-sm dark:text-foreground/95 dark:bg-background/95",children:[(0,a.jsx)("option",{value:"",children:"全部年份"}),ex.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:ed,className:"w-full",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"清除篩選"]})})]})})})]}),(null==X?void 0:X.needsMigration)&&(0,a.jsxs)("div",{className:"bg-yellow-100 dark:bg-yellow-900/20 border border-yellow-400 dark:border-yellow-800 text-yellow-700 dark:text-yellow-200 px-4 py-3 rounded mb-6 flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.Z,{className:"w-5 h-5 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm",children:"發現舊版數據，建議進行數據遷移。"})]}),(0,a.jsx)(i.z,{variant:"outline",size:"sm",onClick:er,disabled:ee,className:"flex-shrink-0",children:ee?"遷移中...":"立即遷移"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-2 sm:space-y-0",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold dark:text-foreground/98",children:W||F||J||q?"搜尋結果":"最近作品"}),ec.length>0&&(0,a.jsxs)("div",{className:"stats-text",children:["共 ",ec.length," 個作品"]})]}),0===ec.length?(0,a.jsx)("div",{className:"text-center py-8 empty-state",children:0===s.length?"還沒有作品，開始新增你的第一個作品吧！":"沒有找到符合條件的作品"}):(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:ec.slice(0,6).map(e=>{var s;let t=e.episodes||[],l=t.filter(e=>e.watched).length,r=t.length;return(0,a.jsxs)(n.Zb,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>window.location.href=(0,x.a)("/works/detail?id=".concat(e.id)),children:[(0,a.jsx)(n.Ol,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between space-y-2 sm:space-y-0",children:[(0,a.jsx)(n.ll,{className:"text-base sm:text-lg line-clamp-2",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(i.z,{size:"sm",variant:"outline",onClick:s=>{s.preventDefault(),s.stopPropagation(),en(e.id,e.title,e.type)},className:"text-xs sm:text-sm",children:[(0,a.jsx)(w.Z,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"新增集數"}),(0,a.jsx)("span",{className:"sm:hidden",children:"新增"})]}),(0,a.jsx)(C.Z,{className:"w-4 h-4 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"})]})]})}),(0,a.jsxs)(n.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(d.C,{variant:"已完結"===e.status?"default":"進行中"===e.status?"secondary":"outline",className:eu(e.status),children:e.status}),(0,a.jsx)(d.C,{className:eh(e.type),children:e.type})]}),e.rating&&(0,a.jsxs)("div",{className:"flex items-center justify-end",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 star-icon mr-1"}),(0,a.jsxs)("span",{className:"text-sm",children:[e.rating,"/5"]})]}),e.review&&(0,a.jsx)("p",{className:"text-xs description-text line-clamp-2",children:e.review}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(S.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{className:"note-text",children:e.year||"未知年份"})]}),r>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(z.Z,{className:"w-3 h-3"}),(0,a.jsxs)("span",{className:"note-text",children:[l,"/",r]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex flex-wrap items-center space-x-2 text-xs sm:text-sm description-text",children:null===(s=e.tags)||void 0===s?void 0:s.map(e=>(0,a.jsx)(d.C,{className:"text-xs",children:e.name},e.id))}),(0,a.jsx)(C.Z,{className:"w-4 h-4 note-text hover:text-gray-600 dark:hover:text-gray-300"})]})]})]},e.id)})}),ec.length>6&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)(i.z,{variant:"outline",children:["查看更多作品",(0,a.jsx)(C.Z,{className:"w-4 h-4 ml-2"})]})})]}),D&&(0,a.jsx)(O,{workId:D.workId,workTitle:D.workTitle,workType:D.workType,currentEpisodes:(null===(e=s.find(e=>e.id===D.workId))||void 0===e?void 0:e.episodes)||[],onEpisodeAdded:ei,onBatchEpisodesAdded:e=>{if(!D)return;let t=s.find(e=>e.id===D.workId);if(!t)return;let a=t.episodes||[],l=e.filter(e=>!a.some(s=>s.season===e.season&&s.number===e.number));if(0===l.length){console.warn("所有集數都已存在");return}let r=[...a,...l].sort((e,s)=>e.season!==s.season?e.season-s.season:e.number-s.number);L(t.id,{episodes:r})},onClose:()=>{R(null)}}),(0,a.jsx)(E.Z,{onSelectAnime:e=>{},onClose:()=>M(!1),isOpen:Y}),(0,a.jsx)(Q,{})]})}}},function(e){e.O(0,[621,250,131,373,330,951,854,971,458,744],function(){return e(e.s=9488)}),_N_E=e.O()}]);