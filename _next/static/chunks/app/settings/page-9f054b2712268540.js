(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{3067:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5817:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},9617:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},6245:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},3673:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]])},1138:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},6512:function(e,s,t){Promise.resolve().then(t.bind(t,4261))},4261:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ej}});var a=t(7437),r=t(2265),l=t(4033),n=t(5671),i=t(575),c=t(2782),d=t(3277),o=t(5744),x=t(2210),u=t(6989),m=t(3763),h=t(4977),p=t(9381),f="Switch",[g,j]=(0,u.b)(f),[y,v]=g(f),b=r.forwardRef((e,s)=>{let{__scopeSwitch:t,name:l,checked:n,defaultChecked:i,required:c,disabled:d,value:u="on",onCheckedChange:h,form:g,...j}=e,[v,b]=r.useState(null),w=(0,x.e)(s,e=>b(e)),N=r.useRef(!1),C=!v||g||!!v.closest("form"),[E,T]=(0,m.T)({prop:n,defaultProp:i??!1,onChange:h,caller:f});return(0,a.jsxs)(y,{scope:t,checked:E,disabled:d,children:[(0,a.jsx)(p.WV.button,{type:"button",role:"switch","aria-checked":E,"aria-required":c,"data-state":D(E),"data-disabled":d?"":void 0,disabled:d,value:u,...j,ref:w,onClick:(0,o.M)(e.onClick,e=>{T(e=>!e),C&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())})}),C&&(0,a.jsx)(k,{control:v,bubbles:!N.current,name:l,value:u,checked:E,required:c,disabled:d,form:g,style:{transform:"translateX(-100%)"}})]})});b.displayName=f;var w="SwitchThumb",N=r.forwardRef((e,s)=>{let{__scopeSwitch:t,...r}=e,l=v(w,t);return(0,a.jsx)(p.WV.span,{"data-state":D(l.checked),"data-disabled":l.disabled?"":void 0,...r,ref:s})});N.displayName=w;var k=r.forwardRef(({__scopeSwitch:e,control:s,checked:t,bubbles:l=!0,...n},i)=>{let c=r.useRef(null),d=(0,x.e)(c,i),o=function(e){let s=r.useRef({value:e,previous:e});return r.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}(t),u=(0,h.t)(s);return r.useEffect(()=>{let e=c.current;if(!e)return;let s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(o!==t&&s){let a=new Event("click",{bubbles:l});s.call(e,t),e.dispatchEvent(a)}},[o,t,l]),(0,a.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...n,tabIndex:-1,ref:d,style:{...n.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function D(e){return e?"checked":"unchecked"}k.displayName="SwitchBubbleInput";var C=t(2169);let E=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(b,{className:(0,C.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50 focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary/90 data-[state=unchecked]:bg-input/60",t),...r,ref:s,children:(0,a.jsx)(N,{className:(0,C.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background/95 shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});E.displayName=b.displayName;var T=t(9766),S=t(3008),A=t(2894),Z=t(9883),I=t(9617),z=t(6245),O=t(4280),M=t(1138);let _=[{id:"anime",name:"動畫",color:"#3B82F6",icon:"\uD83C\uDFAC",description:"日本動畫作品",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"movie",name:"電影",color:"#EF4444",icon:"\uD83C\uDFAD",description:"電影作品",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"tv",name:"電視劇",color:"#10B981",icon:"\uD83D\uDCFA",description:"電視劇作品",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"novel",name:"小說",color:"#8B5CF6",icon:"\uD83D\uDCDA",description:"小說作品",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"manga",name:"漫畫",color:"#F59E0B",icon:"\uD83D\uDCD6",description:"漫畫作品",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"game",name:"遊戲",color:"#EC4899",icon:"\uD83C\uDFAE",description:"遊戲作品",isDefault:!0,isEnabled:!1,createdAt:new Date().toISOString()}],P="watchedit_work_types";function F(){return new Date().toISOString()}let W={getAll(){try{let e=localStorage.getItem(P);if(e)return JSON.parse(e);return this.initializeDefaultTypes(),_}catch(e){return console.error("讀取作品類型數據失敗:",e),_}},initializeDefaultTypes(){localStorage.setItem(P,JSON.stringify(_))},getEnabled(){return this.getAll().filter(e=>e.isEnabled)},create(e){let s=this.getAll(),t={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let s=16*Math.random()|0;return("x"===e?s:3&s|8).toString(16)}),...e,createdAt:F()};return s.push(t),localStorage.setItem(P,JSON.stringify(s)),t},update(e,s){let t=this.getAll(),a=t.findIndex(s=>s.id===e);return -1===a?null:(t[a]={...t[a],...s,updatedAt:F()},localStorage.setItem(P,JSON.stringify(t)),t[a])},delete(e){let s=this.getAll(),t=s.find(s=>s.id===e);if(null==t?void 0:t.isDefault)throw Error("無法刪除預設作品類型");let a=s.filter(s=>s.id!==e);return a.length!==s.length&&(localStorage.setItem(P,JSON.stringify(a)),!0)},toggleEnabled(e){let s=this.getAll(),t=s.find(s=>s.id===e);if(!t)return null;if(!t.isEnabled&&0===s.filter(e=>e.isEnabled).length)throw Error("至少需要保留一個啟用的作品類型");return this.update(e,{isEnabled:!t.isEnabled})},resetToDefault(){localStorage.setItem(P,JSON.stringify(_))},isNameDuplicate(e,s){return this.getAll().some(t=>t.name===e&&t.id!==s)},getTypeNames(){return this.getEnabled().map(e=>e.name)},getByName(e){return this.getAll().find(s=>s.name===e)||null}};var B=t(4222),L=t(6096),R=t(4494);function U(e){let{onTypesChange:s}=e,[t,l]=(0,r.useState)([]),[o,x]=(0,r.useState)(null),[u,m]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[f,g]=(0,r.useState)([]),[j,y]=(0,r.useState)(null);(0,r.useEffect)(()=>{v(),b()},[]);let v=()=>{try{let e=W.getAll();l(e),null==s||s(e)}catch(e){console.error("載入作品類型失敗:",e),l(_)}},b=()=>{try{let e=L.e.getEnabledTypes();g(e)}catch(e){console.error("載入集數類型失敗:",e)}},w=(e,s)=>{y({type:e,text:s}),setTimeout(()=>y(null),3e3)},N=e=>{x({...e}),m(!1);try{let s=B.u.getByWorkType(e.name);if(s)p({episodeTypes:s.episodeTypes,defaultEpisodeType:s.defaultEpisodeType});else{let s=R.n.find(s=>s.workType===e.name);p({episodeTypes:(null==s?void 0:s.episodeTypes)||["episode"],defaultEpisodeType:(null==s?void 0:s.defaultEpisodeType)||"episode"})}}catch(e){console.error("載入集數類型設定失敗:",e),p({episodeTypes:["episode"],defaultEpisodeType:"episode"})}},k=e=>{if(e.isDefault){w("error","無法刪除預設的作品類型");return}if(confirm("確定要刪除類型「".concat(e.name,"」嗎？")))try{W.delete(e.id);try{B.u.delete(e.name)}catch(e){console.error("刪除集數類型對應失敗:",e)}w("success","成功刪除類型「".concat(e.name,"」")),v()}catch(e){console.error("刪除作品類型失敗:",e),w("error",e instanceof Error?e.message:"刪除失敗")}},D=e=>{try{W.toggleEnabled(e.id),v()}catch(e){console.error("切換啟用狀態失敗:",e),w("error","切換失敗")}};return(0,a.jsxs)("div",{className:"space-y-4",children:[j&&(0,a.jsxs)("div",{className:"p-3 rounded-md flex items-center gap-2 ".concat("success"===j.type?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800":"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-800"),children:["success"===j.type?(0,a.jsx)(S.Z,{className:"w-4 h-4"}):(0,a.jsx)(A.Z,{className:"w-4 h-4"}),j.text]}),o&&(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"flex items-center gap-2",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{className:"w-5 h-5"}),"新增作品類型"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{className:"w-5 h-5"}),"編輯作品類型"]})})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"類型名稱 *"}),(0,a.jsx)(c.I,{value:o.name,onChange:e=>x({...o,name:e.target.value}),placeholder:"例如：動畫",className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"描述"}),(0,a.jsx)(c.I,{value:o.description,onChange:e=>x({...o,description:e.target.value}),placeholder:"可選的描述",className:"mt-1"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"圖示"}),(0,a.jsx)(c.I,{value:o.icon,onChange:e=>x({...o,icon:e.target.value}),placeholder:"例如：\uD83D\uDCFA",className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"顏色"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("input",{type:"color",value:o.color,onChange:e=>x({...o,color:e.target.value}),className:"w-10 h-10 rounded border"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:o.color})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"啟用"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"是否啟用此類型"})]}),(0,a.jsx)(E,{checked:o.isEnabled,onCheckedChange:e=>x({...o,isEnabled:e})})]}),h&&(0,a.jsxs)("div",{className:"space-y-4 border-t pt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"集數類型設定"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"設定此作品類型可用的集數類型"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"可用的集數類型 *"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:f.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(E,{checked:h.episodeTypes.includes(e.name),onCheckedChange:()=>{let s=h.episodeTypes.includes(e.name)?h.episodeTypes.filter(s=>s!==e.name):[...h.episodeTypes,e.name];p({...h,episodeTypes:s})}}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full flex items-center justify-center text-white text-xs",children:e.icon}),(0,a.jsx)(T._,{className:"text-sm",children:e.label})]})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"預設集數類型 *"}),(0,a.jsx)("select",{value:h.defaultEpisodeType,onChange:e=>p({...h,defaultEpisodeType:e.target.value}),className:"w-full mt-1 p-2 border rounded-md dark:text-foreground/95 dark:bg-background/95",required:!0,children:h.episodeTypes.map(e=>{let s=f.find(s=>s.name===e);return(0,a.jsx)("option",{value:e,children:(null==s?void 0:s.label)||e},e)})})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{onClick:()=>{if(o&&h)try{var e,s,t;if(!o.name.trim()){w("error","請輸入類型名稱");return}if(!o.color){w("error","請選擇顏色");return}if(0===h.episodeTypes.length){w("error","請至少選擇一個集數類型");return}if(!h.episodeTypes.includes(h.defaultEpisodeType)){w("error","預設集數類型必須在可用的集數類型中");return}if(W.isNameDuplicate(o.name,o.id)){w("error","類型名稱已存在");return}if(u){let s=W.create({name:o.name.trim(),color:o.color,icon:o.icon||"\uD83D\uDCDD",description:(null===(e=o.description)||void 0===e?void 0:e.trim())||"",isDefault:!1,isEnabled:o.isEnabled});try{B.u.create({workType:s.name,episodeTypes:h.episodeTypes,defaultEpisodeType:h.defaultEpisodeType})}catch(e){console.error("新增集數類型對應失敗:",e)}w("success","成功新增類型「".concat(s.name,"」"))}else{if(!o.id)return;let e=null===(s=W.getAll().find(e=>e.id===o.id))||void 0===s?void 0:s.name,a=W.update(o.id,{name:o.name.trim(),color:o.color,icon:o.icon||"\uD83D\uDCDD",description:(null===(t=o.description)||void 0===t?void 0:t.trim())||"",isEnabled:o.isEnabled});if(a){try{e&&e!==a.name&&B.u.delete(e),B.u.getByWorkType(a.name)?B.u.update(a.name,{episodeTypes:h.episodeTypes,defaultEpisodeType:h.defaultEpisodeType}):B.u.create({workType:a.name,episodeTypes:h.episodeTypes,defaultEpisodeType:h.defaultEpisodeType})}catch(e){console.error("更新集數類型對應失敗:",e)}w("success","成功更新類型「".concat(a.name,"」"))}else w("error","更新失敗")}x(null),p(null),m(!1),v()}catch(e){console.error("儲存作品類型失敗:",e),w("error",e instanceof Error?e.message:"儲存失敗")}},children:[(0,a.jsx)(z.Z,{className:"w-4 h-4 mr-2"}),"儲存"]}),(0,a.jsx)(i.z,{variant:"outline",onClick:()=>{x(null),p(null),m(!1)},children:"取消"})]})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(n.ll,{children:"作品類型"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{onClick:()=>{m(!0),x({id:"",name:"",color:"#3B82F6",icon:"\uD83D\uDCDD",description:"",isDefault:!1,isEnabled:!0,createdAt:new Date().toISOString()});let e=L.e.getEnabledTypes();e.length>0&&p({episodeTypes:[e[0].name],defaultEpisodeType:e[0].name})},variant:"outline",size:"sm",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"新增類型"]}),(0,a.jsxs)(i.z,{onClick:()=>{if(confirm("確定要重置為預設類型嗎？這將清除所有自訂類型和集數類型對應。"))try{W.resetToDefault();try{B.u.resetToDefault()}catch(e){console.error("重置集數類型對應失敗:",e)}w("success","已重置為預設類型"),v()}catch(e){console.error("重置作品類型失敗:",e),w("error","重置失敗")}},variant:"outline",size:"sm",children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 mr-2"}),"重置預設"]})]})]})}),(0,a.jsx)(n.aY,{children:(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white",children:e.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.description})]}),e.isDefault&&(0,a.jsx)(d.C,{variant:"secondary",className:"text-xs",children:"預設"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E,{checked:e.isEnabled,onCheckedChange:()=>D(e)}),(0,a.jsx)(i.z,{onClick:()=>N(e),variant:"outline",size:"sm",children:(0,a.jsx)(I.Z,{className:"w-4 h-4"})}),!e.isDefault&&(0,a.jsx)(i.z,{onClick:()=>k(e),variant:"outline",size:"sm",className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300",children:(0,a.jsx)(M.Z,{className:"w-4 h-4"})})]})]},e.id))})})]})]})}function Y(e){let{onTypesChange:s}=e,[t,l]=(0,r.useState)([]),[o,x]=(0,r.useState)(null),[u,m]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{f()},[]);let f=()=>{try{let e=L.e.getAll();l(e),null==s||s(e)}catch(e){console.error("載入集數類型失敗:",e),l(R.h)}},g=(e,s)=>{p({type:e,text:s}),setTimeout(()=>p(null),3e3)},j=e=>{x({...e}),m(!1)},y=e=>{if(e.isDefault){g("error","無法刪除預設的集數類型");return}if(confirm("確定要刪除集數類型「".concat(e.label,"」嗎？")))try{L.e.delete(e.id),g("success","成功刪除集數類型「".concat(e.label,"」")),f()}catch(e){console.error("刪除集數類型失敗:",e),g("error",e instanceof Error?e.message:"刪除失敗")}},v=e=>{try{L.e.toggleEnabled(e.id),f()}catch(e){console.error("切換啟用狀態失敗:",e),g("error","切換失敗")}};return(0,a.jsxs)("div",{className:"space-y-4",children:[h&&(0,a.jsxs)("div",{className:"p-3 rounded-md flex items-center gap-2 ".concat("success"===h.type?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800":"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-800"),children:["success"===h.type?(0,a.jsx)(S.Z,{className:"w-4 h-4"}):(0,a.jsx)(A.Z,{className:"w-4 h-4"}),h.text]}),o&&(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{className:"flex items-center gap-2",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{className:"w-5 h-5"}),"新增集數類型"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{className:"w-5 h-5"}),"編輯集數類型"]})})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"類型名稱 *"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"用於系統識別的英文名稱"}),(0,a.jsx)(c.I,{value:o.name,onChange:e=>x({...o,name:e.target.value}),placeholder:"例如：episode",className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"顯示標籤 *"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"顯示給用戶看的中文名稱"}),(0,a.jsx)(c.I,{value:o.label,onChange:e=>x({...o,label:e.target.value}),placeholder:"例如：正篇",className:"mt-1"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"圖示"}),(0,a.jsx)(c.I,{value:o.icon,onChange:e=>x({...o,icon:e.target.value}),placeholder:"例如：\uD83D\uDCFA",className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"顏色"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("input",{type:"color",value:o.color,onChange:e=>x({...o,color:e.target.value}),className:"w-10 h-10 rounded border"}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:o.color})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{className:"text-sm font-medium",children:"啟用"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"是否啟用此類型"})]}),(0,a.jsx)(E,{checked:o.isEnabled,onCheckedChange:e=>x({...o,isEnabled:e})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{onClick:()=>{if(o)try{if(!o.name.trim()){g("error","請輸入類型名稱");return}if(!o.label.trim()){g("error","請輸入顯示標籤");return}if(!o.color){g("error","請選擇顏色");return}if(L.e.isNameDuplicate(o.name,o.id)){g("error","類型名稱已存在");return}if(u){let e=L.e.create({name:o.name.trim(),label:o.label.trim(),color:o.color,icon:o.icon||"\uD83D\uDCDD",isDefault:!1,isEnabled:o.isEnabled});g("success","成功新增集數類型「".concat(e.label,"」"))}else{if(!o.id)return;let e=L.e.update(o.id,{name:o.name.trim(),label:o.label.trim(),color:o.color,icon:o.icon||"\uD83D\uDCDD",isEnabled:o.isEnabled});e?g("success","成功更新集數類型「".concat(e.label,"」")):g("error","更新失敗")}x(null),m(!1),f()}catch(e){console.error("儲存集數類型失敗:",e),g("error",e instanceof Error?e.message:"儲存失敗")}},children:[(0,a.jsx)(z.Z,{className:"w-4 h-4 mr-2"}),"儲存"]}),(0,a.jsx)(i.z,{variant:"outline",onClick:()=>{x(null),m(!1)},children:"取消"})]})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(n.ll,{children:"集數類型"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.z,{onClick:()=>{m(!0),x({id:"",name:"",label:"",color:"#3B82F6",icon:"\uD83D\uDCDD",isDefault:!1,isEnabled:!0,createdAt:new Date().toISOString()})},variant:"outline",size:"sm",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"新增類型"]}),(0,a.jsxs)(i.z,{onClick:()=>{if(confirm("確定要重置為預設集數類型嗎？這將清除所有自訂類型。"))try{L.e.resetToDefault(),g("success","已重置為預設集數類型"),f()}catch(e){console.error("重置集數類型失敗:",e),g("error","重置失敗")}},variant:"outline",size:"sm",children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 mr-2"}),"重置預設"]})]})]})}),(0,a.jsx)(n.aY,{children:(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white",children:e.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name})]}),e.isDefault&&(0,a.jsx)(d.C,{variant:"secondary",className:"text-xs",children:"預設"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E,{checked:e.isEnabled,onCheckedChange:()=>v(e)}),(0,a.jsx)(i.z,{onClick:()=>j(e),variant:"outline",size:"sm",children:(0,a.jsx)(I.Z,{className:"w-4 h-4"})}),!e.isDefault&&(0,a.jsx)(i.z,{onClick:()=>y(e),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(M.Z,{className:"w-4 h-4"})})]})]},e.id))})})]})]})}var q=t(954);function J(){let[e,s]=(0,r.useState)(null);return((0,r.useEffect)(()=>{s(q.O.getPlatformInfo())},[]),e)?(0,a.jsxs)(n.Zb,{className:"mb-4",children:[(0,a.jsx)(n.Ol,{children:(0,a.jsx)(n.ll,{children:"平台資訊"})}),(0,a.jsxs)(n.aY,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"PWA 模式:"}),(0,a.jsx)("span",{className:e.isPWA?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400",children:e.isPWA?"是":"否"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"行動裝置:"}),(0,a.jsx)("span",{className:e.isMobile?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400",children:e.isMobile?"是":"否"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"iOS:"}),(0,a.jsx)("span",{className:e.isIOS?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400",children:e.isIOS?"是":"否"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Android:"}),(0,a.jsx)("span",{className:e.isAndroid?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400",children:e.isAndroid?"是":"否"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"桌面:"}),(0,a.jsx)("span",{className:e.isDesktop?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400",children:e.isDesktop?"是":"否"})]})]}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("div",{children:"User Agent:"}),(0,a.jsx)("div",{className:"break-all",children:e.userAgent})]})]})]}):null}var H=t(3397),K=t(3536),V=t(5125),X=t(5809),G=t(5343),Q=t(1396),$=t.n(Q),ee=t(3067),es=t(2898);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let et=(0,es.Z)("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);var ea=t(4135),er=t(3088),el=t(612);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let en=(0,es.Z)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);var ei=t(5817);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let ec=(0,es.Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);var ed=t(8956);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let eo=(0,es.Z)("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),ex=(0,es.Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var eu=t(6141),em=t(3423);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let eh=(0,es.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var ep=t(3673),ef=t(8291),eg=t(9409);function ej(){let e=(0,l.useRouter)(),{works:s,tags:t,updateWorks:o,updateTags:x}=(0,K.B)(),[u,m]=(0,r.useState)({storageMode:"local",cloudEndpoint:"",cloudApiKey:"",autoSync:!1,syncInterval:30,notifications:!0,theme:"auto",language:"zh-TW",dataBackup:!0,dataBackupInterval:7,pwaNotifications:!0,pwaAutoUpdate:!0,pwaOfflineMode:!0}),{theme:h,setTheme:p,systemTheme:f}=(0,H.useTheme)(),[g,j]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null),[b,w]=(0,r.useState)({isPWA:!1,isMobile:!1,isIOS:!1,isAndroid:!1,isDesktop:!1,canInstall:!1,isInstalled:!1,notificationPermission:"default"});(0,r.useEffect)(()=>{try{{let e=localStorage.getItem("watchedit_settings");e&&m(JSON.parse(e))}}catch(e){console.error("載入設定失敗:",e)}N()},[]);let N=()=>{{let e=q.O.getPlatformInfo();w({...e,canInstall:!1,isInstalled:e.isPWA,notificationPermission:Notification.permission})}},k=async()=>{j(!0);try{let e={...await X.qC.exportData(),exportDate:new Date().toISOString(),version:"1.0.0"},s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="watchedit_backup_".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),v({type:"success",text:"資料匯出成功"}),setTimeout(()=>v(null),3e3)}catch(e){console.error("匯出資料失敗:",e),v({type:"error",text:"匯出資料失敗"}),setTimeout(()=>v(null),3e3)}finally{j(!1)}},D=async()=>{if(confirm("確定要清除所有資料嗎？此操作無法復原！"))try{await X.qC.clearAll(),await o([]),await x([]),v({type:"success",text:"資料已清除"}),setTimeout(()=>v(null),3e3)}catch(e){console.error("清除資料失敗:",e),v({type:"error",text:"清除資料失敗"}),setTimeout(()=>v(null),3e3)}},Z=async()=>{if(!u.cloudEndpoint){v({type:"error",text:"請先輸入雲端端點"}),setTimeout(()=>v(null),3e3);return}j(!0);try{let e=await V.a.testConnection(u.cloudEndpoint);if(e.success){let e={...u,storageMode:"cloud"};m(e);let s={endpoint:u.cloudEndpoint,apiKey:u.cloudApiKey||void 0};V.a.setConfig(s),localStorage.setItem("watchedit_settings",JSON.stringify(e)),v({type:"success",text:"連接測試成功，端點已自動儲存"})}else v({type:"error",text:e.message});setTimeout(()=>v(null),3e3)}catch(e){v({type:"error",text:"連接測試失敗"}),setTimeout(()=>v(null),3e3)}finally{j(!1)}},I=async()=>{if(!u.cloudEndpoint){v({type:"error",text:"請先設定雲端端點"}),setTimeout(()=>v(null),3e3);return}j(!0);try{let e=await V.a.uploadData(s,t);e.success?(V.a.setLastSyncTime(),v({type:"success",text:"數據已成功上傳到雲端"})):v({type:"error",text:e.message}),setTimeout(()=>v(null),3e3)}catch(e){v({type:"error",text:"同步失敗"}),setTimeout(()=>v(null),3e3)}finally{j(!1)}},_=async()=>{if(!u.cloudEndpoint){v({type:"error",text:"請先設定雲端端點"}),setTimeout(()=>v(null),3e3);return}j(!0);try{let e=await V.a.downloadData();e.success&&e.data?(o(e.data.works),x(e.data.tags),V.a.setLastSyncTime(),v({type:"success",text:e.message})):v({type:"error",text:e.message}),setTimeout(()=>v(null),3e3)}catch(e){v({type:"error",text:"下載失敗"}),setTimeout(()=>v(null),3e3)}finally{j(!1)}},P=async()=>{try{let e=await q.O.requestNotificationPermission();N(),e?v({type:"success",text:"通知權限已啟用"}):v({type:"error",text:"通知權限被拒絕"}),setTimeout(()=>v(null),3e3)}catch(e){v({type:"error",text:"請求通知權限失敗"}),setTimeout(()=>v(null),3e3)}},F=async()=>{try{await q.O.checkForUpdate()?v({type:"success",text:"檢查更新完成"}):v({type:"error",text:"無法檢查更新"}),setTimeout(()=>v(null),3e3)}catch(e){v({type:"error",text:"檢查更新失敗"}),setTimeout(()=>v(null),3e3)}};return(0,a.jsxs)("div",{className:"container mx-auto p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>e.back(),children:[(0,a.jsx)(ee.Z,{className:"w-4 h-4 mr-2"}),"返回"]}),(0,a.jsx)(G.Z,{showText:!1}),(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold",children:"設定"})]}),(0,a.jsxs)(i.z,{onClick:()=>{try{if(localStorage.setItem("watchedit_settings",JSON.stringify(u)),"cloud"===u.storageMode&&u.cloudEndpoint){let e={endpoint:u.cloudEndpoint,apiKey:u.cloudApiKey||void 0};V.a.setConfig(e)}v({type:"success",text:"設定已儲存"}),setTimeout(()=>v(null),3e3)}catch(e){console.error("儲存設定失敗:",e),v({type:"error",text:"儲存設定失敗"}),setTimeout(()=>v(null),3e3)}},className:"w-full sm:w-auto",children:[(0,a.jsx)(z.Z,{className:"w-4 h-4 mr-2"}),"儲存設定"]})]}),y&&(0,a.jsxs)("div",{className:"mb-4 p-4 rounded-md flex items-center space-x-2 ".concat("success"===y.type?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800":"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-800"),children:["success"===y.type?(0,a.jsx)(S.Z,{className:"w-4 h-4"}):(0,a.jsx)(A.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:y.text})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(et,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"外觀設定"})]})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"theme",children:"主題"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(i.z,{variant:"light"===h?"default":"outline",size:"sm",onClick:()=>p("light"),children:[(0,a.jsx)(ea.Z,{className:"w-4 h-4 mr-1"}),"淺色"]}),(0,a.jsxs)(i.z,{variant:"dark"===h?"default":"outline",size:"sm",onClick:()=>p("dark"),children:[(0,a.jsx)(er.Z,{className:"w-4 h-4 mr-1"}),"深色"]}),(0,a.jsxs)(i.z,{variant:"auto"===h?"default":"outline",size:"sm",onClick:()=>p("auto"),children:[(0,a.jsx)(el.Z,{className:"w-4 h-4 mr-1"}),"自動"]})]})]}),"auto"===h&&(0,a.jsxs)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(el.Z,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"自動模式"})]}),(0,a.jsxs)("div",{className:"text-xs text-blue-600 dark:text-blue-300 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"系統主題:"}),(0,a.jsx)(d.C,{variant:"outline",className:"text-xs",children:"dark"===f?"深色":"淺色"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"當前應用:"}),(0,a.jsx)(d.C,{variant:"default",className:"text-xs",children:"dark"===f?"深色":"淺色"})]}),(0,a.jsx)("p",{className:"text-xs mt-2",children:"系統主題變化時會自動切換"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"language",children:"語言"}),(0,a.jsxs)("select",{id:"language",value:u.language,onChange:e=>m({...u,language:e.target.value}),className:"p-2 border rounded-md dark:text-foreground/95 dark:bg-background/95",children:[(0,a.jsx)("option",{value:"zh-TW",children:"繁體中文"}),(0,a.jsx)("option",{value:"en-US",children:"English"})]})]})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(en,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"PWA 設定"})]})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"PWA 狀態"}),(0,a.jsx)(d.C,{variant:b.isPWA?"default":"secondary",children:b.isPWA?"已安裝":"未安裝"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"平台"}),(0,a.jsx)(d.C,{variant:"outline",children:b.isIOS?"iOS":b.isAndroid?"Android":"桌面"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"通知權限"}),(0,a.jsx)(d.C,{variant:"granted"===b.notificationPermission?"default":"denied"===b.notificationPermission?"destructive":"secondary",children:"granted"===b.notificationPermission?"已授權":"denied"===b.notificationPermission?"已拒絕":"未設定"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"pwaNotifications",children:"PWA 通知"}),(0,a.jsx)(E,{id:"pwaNotifications",checked:u.pwaNotifications,onCheckedChange:e=>m({...u,pwaNotifications:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"pwaAutoUpdate",children:"自動更新"}),(0,a.jsx)(E,{id:"pwaAutoUpdate",checked:u.pwaAutoUpdate,onCheckedChange:e=>m({...u,pwaAutoUpdate:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"pwaOfflineMode",children:"離線模式"}),(0,a.jsx)(E,{id:"pwaOfflineMode",checked:u.pwaOfflineMode,onCheckedChange:e=>m({...u,pwaOfflineMode:e})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[!b.isPWA&&(0,a.jsxs)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(ei.Z,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"安裝 PWA"})]}),(0,a.jsx)("p",{className:"text-xs text-blue-600 dark:text-blue-300 mb-2",children:b.isIOS?"點擊 Safari 的分享按鈕，選擇「加入主畫面」":b.isAndroid?"點擊瀏覽器選單，選擇「安裝應用程式」":"點擊瀏覽器地址欄旁的安裝圖示"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:P,disabled:"granted"===b.notificationPermission,children:[(0,a.jsx)(ec,{className:"w-4 h-4 mr-2"}),"請求通知權限"]}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:F,children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 mr-2"}),"檢查更新"]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2 text-xs text-gray-600 dark:text-gray-400",children:b.isPWA?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ed.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"PWA 模式運行中"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"瀏覽器模式"})]})})]})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(ex,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"資料管理"})]})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"storageMode",children:"儲存模式"}),(0,a.jsxs)("select",{id:"storageMode",value:u.storageMode,onChange:e=>m({...u,storageMode:e.target.value}),className:"p-2 border rounded-md dark:text-foreground/95 dark:bg-background/95",children:[(0,a.jsx)("option",{value:"local",children:"本地儲存"}),(0,a.jsx)("option",{value:"cloud",children:"雲端同步"})]})]}),"cloud"===u.storageMode&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{htmlFor:"cloudEndpoint",children:"雲端端點"}),(0,a.jsx)(c.I,{id:"cloudEndpoint",value:u.cloudEndpoint,onChange:e=>m({...u,cloudEndpoint:e.target.value}),placeholder:"https://your-server.com/api",className:"mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(T._,{htmlFor:"cloudApiKey",children:"API 金鑰 (可選)"}),(0,a.jsx)(c.I,{id:"cloudApiKey",type:"password",value:u.cloudApiKey,onChange:e=>m({...u,cloudApiKey:e.target.value}),placeholder:"輸入 API 金鑰",className:"mt-1"})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:Z,disabled:g,children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 mr-2 ".concat(g?"animate-spin":"")}),"測試連接"]})}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:I,disabled:g,children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 mr-2"}),"同步到雲端"]}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:_,disabled:g,children:[(0,a.jsx)(ei.Z,{className:"w-4 h-4 mr-2"}),"從雲端下載"]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eu.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["最後同步: ",(()=>{let e=V.a.getLastSyncTime();return e?new Date(e).toLocaleString("zh-TW"):"從未同步"})()]})]}),V.a.shouldSync()&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-orange-600 dark:text-orange-400",children:[(0,a.jsx)(A.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"建議進行同步"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"autoSync",children:"自動同步"}),(0,a.jsx)(E,{id:"autoSync",checked:u.autoSync,onCheckedChange:e=>m({...u,autoSync:e})})]}),u.autoSync&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"syncInterval",children:"同步間隔 (分鐘)"}),(0,a.jsx)(c.I,{id:"syncInterval",type:"number",value:u.syncInterval,onChange:e=>m({...u,syncInterval:parseInt(e.target.value)}),min:"1",max:"1440",className:"w-20 dark:text-foreground/95"})]})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(em.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"備份設定"})]})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"dataBackup",children:"自動備份"}),(0,a.jsx)(E,{id:"dataBackup",checked:u.dataBackup,onCheckedChange:e=>m({...u,dataBackup:e})})]}),u.dataBackup&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"dataBackupInterval",children:"備份間隔 (天)"}),(0,a.jsx)(c.I,{id:"dataBackupInterval",type:"number",value:u.dataBackupInterval,onChange:e=>m({...u,dataBackupInterval:parseInt(e.target.value)}),min:"1",max:"30",className:"w-20 dark:text-foreground/95"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(i.z,{variant:"outline",onClick:k,disabled:g,children:[(0,a.jsx)(ei.Z,{className:"w-4 h-4 mr-2"}),"匯出資料"]}),(0,a.jsxs)(i.z,{variant:"outline",onClick:()=>{let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(t){let e=new FileReader;e.onload=async e=>{try{var s;let t=JSON.parse(null===(s=e.target)||void 0===s?void 0:s.result);t.works&&t.tags&&(await X.qC.importData({works:t.works,tags:t.tags}),await o(t.works),await x(t.tags)),v({type:"success",text:"資料匯入成功"}),setTimeout(()=>v(null),3e3)}catch(e){console.error("匯入資料失敗:",e),v({type:"error",text:"匯入資料失敗"}),setTimeout(()=>v(null),3e3)}},e.readAsText(t)}},e.click()},disabled:g,children:[(0,a.jsx)(eh,{className:"w-4 h-4 mr-2"}),"匯入資料"]})]}),(0,a.jsxs)(i.z,{variant:"destructive",onClick:D,disabled:g,children:[(0,a.jsx)(M.Z,{className:"w-4 h-4 mr-2"}),"清除所有資料"]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(ep.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"標籤管理"})]})}),(0,a.jsxs)(n.aY,{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"管理作品標籤，可以新增、編輯和刪除標籤。"}),(0,a.jsx)($(),{href:(0,C.a)("/settings/tags"),children:(0,a.jsxs)(i.z,{className:"w-full",children:["管理標籤",(0,a.jsx)(ef.Z,{className:"w-4 h-4 ml-2"})]})})]})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(eg.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"作品類型管理"})]})}),(0,a.jsx)(n.aY,{children:(0,a.jsx)(U,{})})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(eg.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"自定義集數類型"})]})}),(0,a.jsx)(n.aY,{children:(0,a.jsx)(Y,{})})]}),(0,a.jsxs)(n.Zb,{children:[(0,a.jsx)(n.Ol,{children:(0,a.jsxs)(n.ll,{className:"flex items-center space-x-2",children:[(0,a.jsx)(A.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"通知設定"})]})}),(0,a.jsxs)(n.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T._,{htmlFor:"notifications",children:"啟用通知"}),(0,a.jsx)(E,{id:"notifications",checked:u.notifications,onCheckedChange:e=>m({...u,notifications:e})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"啟用後會顯示瀏覽器通知，提醒您觀看進度。"})]})]})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(J,{})})]})}},3277:function(e,s,t){"use strict";t.d(s,{C:function(){return i}});var a=t(7437);t(2265);var r=t(6061),l=t(2169);let n=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary/90 text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary/90 text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive/90 text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground border-border/60"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,l.cn)(n({variant:t}),s),...r})}},2782:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var a=t(7437),r=t(2265),l=t(2169);let n=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input/60 bg-background/95 px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},9766:function(e,s,t){"use strict";t.d(s,{_:function(){return o}});var a=t(7437),r=t(2265),l=t(9381),n=r.forwardRef((e,s)=>(0,a.jsx)(l.WV.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));n.displayName="Label";var i=t(6061),c=t(2169);let d=(0,i.j)("text-sm font-medium leading-none text-foreground/95 peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(n,{ref:s,className:(0,c.cn)(d(),t),...r})});o.displayName=n.displayName},3536:function(e,s,t){"use strict";t.d(s,{B:function(){return l}});var a=t(4660),r=t(5809);let l=(0,a.Ue)((e,s)=>({works:[],tags:[],stats:null,loading:!1,error:null,initialize:async()=>{try{await r.we.init(),await r.IL.init();let s=await r.we.getAll();0===s.length&&await (0,r.W0)();let t=await r.we.getAll(),a=await r.IL.getAll(),l=await r.we.getStats();e({works:t,tags:a,stats:l})}catch(s){console.error("初始化失敗:",s),e({error:"初始化失敗"})}},fetchWorks:async s=>{e({loading:!0,error:null});try{let t=await r.we.getList(s);return e({works:t.works,loading:!1}),t}catch(s){throw e({error:s instanceof Error?s.message:"取得作品列表失敗",loading:!1}),s}},createWork:async s=>{e({loading:!0,error:null});try{if(await r.we.findByTitle(s.title))throw Error("作品「".concat(s.title,"」已存在於您的收藏中！"));if("AniList"===s.source&&s.note){let e=s.note.match(/AniList ID: (\d+)/);if(e){let t=parseInt(e[1]);if(await r.we.findByAniListId(t))throw Error("作品「".concat(s.title,"」已存在於您的收藏中！"))}}let t=await r.we.create(s),a=await r.we.getAll(),l=await r.we.getStats();return e({works:a,stats:l,loading:!1}),t}catch(s){throw e({error:s instanceof Error?s.message:"新增作品失敗",loading:!1}),s}},updateWork:async(s,t)=>{e({loading:!0,error:null});try{let a=await r.we.update(s,t);if(!a)throw Error("作品不存在");let l=await r.we.getAll(),n=await r.we.getStats();return e({works:l,stats:n,loading:!1}),a}catch(s){throw e({error:s instanceof Error?s.message:"更新作品失敗",loading:!1}),s}},deleteWork:async s=>{e({loading:!0,error:null});try{if(!await r.we.delete(s))throw Error("作品不存在");let t=await r.we.getAll(),a=await r.we.getStats();return e({works:t,stats:a,loading:!1}),!0}catch(s){throw e({error:s instanceof Error?s.message:"刪除作品失敗",loading:!1}),s}},getWork:async e=>{try{return(await r.we.getAll()).find(s=>s.id===e)||null}catch(e){return console.error("取得作品失敗:",e),null}},updateWorks:async s=>{try{await r.we.setAll(s),e({works:s})}catch(e){console.error("更新作品失敗:",e)}},fetchTags:async()=>{e({loading:!0,error:null});try{let s=await r.IL.getAll();return e({tags:s,loading:!1}),s}catch(s){throw e({error:s instanceof Error?s.message:"取得標籤列表失敗",loading:!1}),s}},createTag:async s=>{e({loading:!0,error:null});try{let t=await r.IL.create(s),a=await r.IL.getAll();return e({tags:a,loading:!1}),t}catch(s){throw e({error:s instanceof Error?s.message:"新增標籤失敗",loading:!1}),s}},updateTag:async(s,t)=>{e({loading:!0,error:null});try{let a=await r.IL.update(s,t);if(!a)throw Error("標籤不存在");let l=await r.IL.getAll();return e({tags:l,loading:!1}),a}catch(s){throw e({error:s instanceof Error?s.message:"更新標籤失敗",loading:!1}),s}},deleteTag:async s=>{e({loading:!0,error:null});try{if(!await r.IL.delete(s))throw Error("標籤不存在");let t=await r.IL.getAll();return e({tags:t,loading:!1}),!0}catch(s){throw e({error:s instanceof Error?s.message:"刪除標籤失敗",loading:!1}),s}},updateTags:async s=>{try{await r.IL.setAll(s),e({tags:s})}catch(e){console.error("更新標籤失敗:",e)}},fetchStats:async()=>{e({loading:!0,error:null});try{let s=await r.we.getStats();return e({stats:s,loading:!1}),s}catch(s){throw e({error:s instanceof Error?s.message:"取得統計數據失敗",loading:!1}),s}}}))},4033:function(e,s,t){e.exports=t(5313)}},function(e){e.O(0,[621,250,131,330,854,971,458,744],function(){return e(e.s=6512)}),_N_E=e.O()}]);