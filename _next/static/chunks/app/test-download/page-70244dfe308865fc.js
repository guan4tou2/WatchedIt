(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[144],{1497:function(e,t,r){Promise.resolve().then(r.bind(r,4042))},4042:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(7437),a=r(2265),s=r(575),o=r(5671),i=r(2782),c=r(9766),d=r(5125);function l(){let[e,t]=(0,a.useState)("http://127.0.0.1:8000/cloud"),[r,l]=(0,a.useState)(""),[u,f]=(0,a.useState)(!1),g=async()=>{f(!0),l("測試中...");try{d.a.setConfig({endpoint:e});let n=await d.a.downloadData();if(n.success){var t,r;l("下載成功！\n作品數量: ".concat((null===(t=n.data)||void 0===t?void 0:t.works.length)||0,"\n標籤數量: ").concat((null===(r=n.data)||void 0===r?void 0:r.tags.length)||0,"\n\n數據: ").concat(JSON.stringify(n.data,null,2)))}else l("下載失敗: ".concat(n.message,"\n錯誤: ").concat(n.error))}catch(e){l("測試失敗: ".concat(e instanceof Error?e.message:"未知錯誤"))}finally{f(!1)}},m=async()=>{f(!0),l("測試連接中...");try{let t=await d.a.testConnection(e);l("連接測試結果: ".concat(t.success?"成功":"失敗","\n訊息: ").concat(t.message))}catch(e){l("連接測試失敗: ".concat(e instanceof Error?e.message:"未知錯誤"))}finally{f(!1)}};return(0,n.jsxs)("div",{className:"container mx-auto p-6",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"雲端下載測試"}),(0,n.jsxs)(o.Zb,{className:"mb-6",children:[(0,n.jsx)(o.Ol,{children:(0,n.jsx)(o.ll,{children:"設定"})}),(0,n.jsxs)(o.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(c._,{htmlFor:"endpoint",children:"雲端端點"}),(0,n.jsx)(i.I,{id:"endpoint",value:e,onChange:e=>t(e.target.value),placeholder:"http://127.0.0.1:8000/cloud"})]}),(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(s.z,{onClick:m,disabled:u,children:u?"測試中...":"測試連接"}),(0,n.jsx)(s.z,{onClick:g,disabled:u,children:u?"下載中...":"測試下載"})]})]})]}),r&&(0,n.jsxs)(o.Zb,{children:[(0,n.jsx)(o.Ol,{children:(0,n.jsx)(o.ll,{children:"測試結果"})}),(0,n.jsx)(o.aY,{children:(0,n.jsx)("pre",{className:"bg-gray-100 p-4 rounded-md overflow-auto text-sm",children:r})})]})]})}},575:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var n=r(7437),a=r(2265),s=r(7256),o=r(6061),i=r(2169);let c=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary/90 text-primary-foreground hover:bg-primary/80",destructive:"bg-destructive/90 text-destructive-foreground hover:bg-destructive/80",outline:"border border-input/60 bg-background hover:bg-accent/50 hover:text-accent-foreground",secondary:"bg-secondary/90 text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent/50 hover:text-accent-foreground",link:"text-primary/90 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:o,asChild:d=!1,...l}=e,u=d?s.g7:"button";return(0,n.jsx)(u,{className:(0,i.cn)(c({variant:a,size:o,className:r})),ref:t,...l})});d.displayName="Button"},5671:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},Zb:function(){return o},aY:function(){return d},ll:function(){return c}});var n=r(7437),a=r(2265),s=r(2169);let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border border-border/60 bg-card/95 text-card-foreground shadow-sm",r),...a})});o.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight text-foreground/95 dark:text-foreground/98",r),...a})});c.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground/80 dark:text-muted-foreground/90",r),...a})}).displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},2782:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var n=r(7437),a=r(2265),s=r(2169);let o=a.forwardRef((e,t)=>{let{className:r,type:a,...o}=e;return(0,n.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input/60 bg-background/95 px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},9766:function(e,t,r){"use strict";r.d(t,{_:function(){return l}});var n=r(7437),a=r(2265),s=r(9381),o=a.forwardRef((e,t)=>(0,n.jsx)(s.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));o.displayName="Label";var i=r(6061),c=r(2169);let d=(0,i.j)("text-sm font-medium leading-none text-foreground/95 peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(o,{ref:t,className:(0,c.cn)(d(),r),...a})});l.displayName=o.displayName},5125:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});class n{getDeviceId(){let e=localStorage.getItem("watchedit_device_id");return e||(e="device_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("watchedit_device_id",e)),e}setConfig(e){this.config=e,localStorage.setItem("watchedit_cloud_config",JSON.stringify(e))}getConfig(){if(!this.config){let e=localStorage.getItem("watchedit_cloud_config");e&&(this.config=JSON.parse(e))}return this.config}async testConnection(e){try{let t=await fetch("".concat(e,"/health"),{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok)return{success:!0,message:"雲端連接測試成功"};return{success:!1,message:"雲端連接失敗",error:"HTTP ".concat(t.status,": ").concat(t.statusText)}}catch(e){return{success:!1,message:"雲端連接失敗",error:e instanceof Error?e.message:"未知錯誤"}}}async uploadData(e,t){var r;if(!(null===(r=this.config)||void 0===r?void 0:r.endpoint))return{success:!1,message:"未設定雲端端點",error:"請先在設定中配置雲端端點"};try{let r={works:e,tags:t,backupDate:new Date().toISOString(),version:"1.0.0",deviceId:this.deviceId},n=await fetch("".concat(this.config.endpoint,"/backup"),{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:"Bearer ".concat(this.config.apiKey)}},body:JSON.stringify(r)});if(!n.ok)return{success:!1,message:"數據上傳失敗",error:"HTTP ".concat(n.status,": ").concat(n.statusText)};{let r=await n.json();return{success:!0,message:"數據上傳成功",data:{works:r.works||e,tags:r.tags||t,lastSync:new Date().toISOString()}}}}catch(e){return{success:!1,message:"數據上傳失敗",error:e instanceof Error?e.message:"未知錯誤"}}}async downloadData(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.endpoint))return{success:!1,message:"未設定雲端端點",error:"請先在設定中配置雲端端點"};try{let e=await fetch("".concat(this.config.endpoint,"/backup?device_id=").concat(this.deviceId),{method:"GET",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:"Bearer ".concat(this.config.apiKey)}}});if(!e.ok)return{success:!1,message:"數據下載失敗",error:"HTTP ".concat(e.status,": ").concat(e.statusText)};{let t=await e.json();return{success:!0,message:"數據下載成功",data:{works:t.works||[],tags:t.tags||[],lastSync:new Date().toISOString()}}}}catch(e){return{success:!1,message:"數據下載失敗",error:e instanceof Error?e.message:"未知錯誤"}}}async syncData(e,t){var r;if(!(null===(r=this.config)||void 0===r?void 0:r.endpoint))return{success:!1,message:"未設定雲端端點",error:"請先在設定中配置雲端端點"};try{let r=await this.downloadData();if(!r.success||!r.data)return await this.uploadData(e,t);{let n=this.mergeWorks(e,r.data.works),a=this.mergeTags(t,r.data.tags),s=await this.uploadData(n,a);if(s.success)return{success:!0,message:"數據同步成功",data:{works:n,tags:a,lastSync:new Date().toISOString()}};return s}}catch(e){return{success:!1,message:"數據同步失敗",error:e instanceof Error?e.message:"未知錯誤"}}}mergeWorks(e,t){let r=[...e],n=new Set(e.map(e=>e.id));for(let a of t)if(n.has(a.id)){let t=e.find(e=>e.id===a.id);if(t&&a.date_updated&&t.date_updated&&new Date(a.date_updated)>new Date(t.date_updated)){let e=r.findIndex(e=>e.id===a.id);-1!==e&&(r[e]=a)}}else r.push(a);return r}mergeTags(e,t){let r=[...e],n=new Set(e.map(e=>e.id));for(let e of t)n.has(e.id)||r.push(e);return r}getLastSyncTime(){return localStorage.getItem("watchedit_last_sync")}setLastSyncTime(){localStorage.setItem("watchedit_last_sync",new Date().toISOString())}shouldSync(){let e=this.getLastSyncTime();if(!e)return!0;let t=new Date(e);return(new Date().getTime()-t.getTime())/36e5>1}clearConfig(){this.config=null,localStorage.removeItem("watchedit_cloud_config"),localStorage.removeItem("watchedit_last_sync")}constructor(){this.config=null,this.deviceId=this.getDeviceId()}}let a=new n},2169:function(e,t,r){"use strict";r.d(t,{a:function(){return o},cn:function(){return s}});var n=r(7042),a=r(4769);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}function o(e){return"".concat("/WatchedIt").concat(e)}},9381:function(e,t,r){"use strict";r.d(t,{WV:function(){return i},jH:function(){return c}});var n=r(2265),a=r(4887),s=r(7256),o=r(7437),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,s.Z8)(`Primitive.${t}`),a=n.forwardRef((e,n)=>{let{asChild:a,...s}=e,i=a?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,o.jsx)(i,{...s,ref:n})});return a.displayName=`Primitive.${t}`,{...e,[t]:a}},{});function c(e,t){e&&a.flushSync(()=>e.dispatchEvent(t))}}},function(e){e.O(0,[621,971,458,744],function(){return e(e.s=1497)}),_N_E=e.O()}]);