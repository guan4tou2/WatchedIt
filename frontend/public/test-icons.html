<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>圖示測試 - WatchedIt</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <link rel="manifest" href="/manifest.json" />
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .icon-test {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .icon-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .icon-item {
        text-align: center;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
      }
      .icon-item img {
        max-width: 100%;
        height: auto;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <h1>🎯 WatchedIt 圖示測試</h1>

    <div class="icon-test">
      <h2>📋 測試項目</h2>
      <div id="test-results"></div>
    </div>

    <div class="icon-test">
      <h2>🖼️ 圖示預覽</h2>
      <div class="icon-grid" id="icon-grid"></div>
    </div>

    <div class="icon-test">
      <h2>📱 PWA 測試</h2>
      <p>檢查瀏覽器開發者工具中的 Application 標籤頁，查看：</p>
      <ul>
        <li>Manifest 是否正確載入</li>
        <li>圖示是否顯示正確</li>
        <li>Service Worker 是否註冊成功</li>
      </ul>
    </div>

    <script>
      const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
      const testResults = document.getElementById("test-results");
      const iconGrid = document.getElementById("icon-grid");

      let passedTests = 0;
      let totalTests = 0;

      function addTestResult(name, passed, message) {
        totalTests++;
        if (passed) passedTests++;

        const div = document.createElement("div");
        div.className = `status ${passed ? "success" : "error"}`;
        div.innerHTML = `${passed ? "✅" : "❌"} ${name}: ${message}`;
        testResults.appendChild(div);
      }

      // 測試圖示檔案是否存在
      async function testIconExists(size) {
        try {
          const response = await fetch(`/icons/icon-${size}x${size}.png`);
          const exists = response.ok;
          addTestResult(
            `圖示 ${size}x${size}`,
            exists,
            exists ? "檔案存在" : "檔案不存在"
          );
          return exists;
        } catch (error) {
          addTestResult(`圖示 ${size}x${size}`, false, "載入失敗");
          return false;
        }
      }

      // 測試 favicon
      async function testFavicon() {
        try {
          const response = await fetch("/favicon.ico");
          const exists = response.ok;
          addTestResult("Favicon", exists, exists ? "檔案存在" : "檔案不存在");
          return exists;
        } catch (error) {
          addTestResult("Favicon", false, "載入失敗");
          return false;
        }
      }

      // 測試 manifest
      async function testManifest() {
        try {
          const response = await fetch("/manifest.json");
          const exists = response.ok;
          addTestResult("Manifest", exists, exists ? "檔案存在" : "檔案不存在");
          return exists;
        } catch (error) {
          addTestResult("Manifest", false, "載入失敗");
          return false;
        }
      }

      // 生成圖示預覽
      function generateIconPreview() {
        sizes.forEach((size) => {
          const div = document.createElement("div");
          div.className = "icon-item";
          div.innerHTML = `
                    <img src="/icons/icon-${size}x${size}.png" alt="${size}x${size}">
                    <p>${size}x${size}</p>
                `;
          iconGrid.appendChild(div);
        });
      }

      // 執行所有測試
      async function runTests() {
        addTestResult("開始測試", true, "測試開始...");

        // 測試 favicon
        await testFavicon();

        // 測試 manifest
        await testManifest();

        // 測試所有圖示
        for (const size of sizes) {
          await testIconExists(size);
        }

        // 總結
        addTestResult(
          "測試總結",
          passedTests === totalTests,
          `${passedTests}/${totalTests} 個測試通過`
        );
      }

      // 初始化
      generateIconPreview();
      runTests();
    </script>
  </body>
</html>
