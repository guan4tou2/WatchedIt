"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{575:function(e,t,r){r.d(t,{z:function(){return l}});var a=r(7437),n=r(2265),o=r(7256),s=r(6061),i=r(2169);let c=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary/90 text-primary-foreground hover:bg-primary/80",destructive:"bg-destructive/90 text-destructive-foreground hover:bg-destructive/80",outline:"border border-input/60 bg-background hover:bg-accent/50 hover:text-accent-foreground",secondary:"bg-secondary/90 text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent/50 hover:text-accent-foreground",link:"text-primary/90 underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef((e,t)=>{let{className:r,variant:n,size:s,asChild:l=!1,...d}=e,u=l?o.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(c({variant:n,size:s,className:r})),ref:t,...d})});l.displayName="Button"},5671:function(e,t,r){r.d(t,{Ol:function(){return i},Zb:function(){return s},aY:function(){return l},ll:function(){return c}});var a=r(7437),n=r(2265),o=r(2169);let s=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border border-border/60 bg-card/95 text-card-foreground shadow-sm",r),...n})});s.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...n})});i.displayName="CardHeader";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight text-foreground/95 dark:text-foreground/98",r),...n})});c.displayName="CardTitle",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground/80 dark:text-muted-foreground/90",r),...n})}).displayName="CardDescription";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...n})});l.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...n})}).displayName="CardFooter"},5809:function(e,t,r){r.d(t,{IL:function(){return c},W0:function(){return l},qC:function(){return d},we:function(){return i}});let a={WORKS:"works",TAGS:"tags"};function n(){return new Date().toISOString()}class o{async init(){return new Promise((e,t)=>{let r=indexedDB.open("WatchedItDB",1);r.onerror=()=>{console.error("IndexedDB 初始化失敗:",r.error),t(r.error)},r.onsuccess=()=>{this.db=r.result,e()},r.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(a.WORKS)){let e=t.createObjectStore(a.WORKS,{keyPath:"id"});e.createIndex("title","title",{unique:!1}),e.createIndex("type","type",{unique:!1}),e.createIndex("status","status",{unique:!1}),e.createIndex("year","year",{unique:!1})}t.objectStoreNames.contains(a.TAGS)||t.createObjectStore(a.TAGS,{keyPath:"id"}).createIndex("name","name",{unique:!1})}})}async ensureDB(){return this.db||await this.init(),this.db}async getAll(e){let t=await this.ensureDB();return new Promise((r,a)=>{let n=t.transaction([e],"readonly").objectStore(e).getAll();n.onerror=()=>a(n.error),n.onsuccess=()=>r(n.result)})}async get(e,t){let r=await this.ensureDB();return new Promise((a,n)=>{let o=r.transaction([e],"readonly").objectStore(e).get(t);o.onerror=()=>n(o.error),o.onsuccess=()=>a(o.result||null)})}async add(e,t){let r=await this.ensureDB();return new Promise((a,n)=>{let o=r.transaction([e],"readwrite").objectStore(e).add(t);o.onerror=()=>n(o.error),o.onsuccess=()=>a()})}async put(e,t){let r=await this.ensureDB();return new Promise((a,n)=>{let o=r.transaction([e],"readwrite").objectStore(e).put(t);o.onerror=()=>n(o.error),o.onsuccess=()=>a()})}async delete(e,t){let r=await this.ensureDB();return new Promise((a,n)=>{let o=r.transaction([e],"readwrite").objectStore(e).delete(t);o.onerror=()=>n(o.error),o.onsuccess=()=>a()})}async clear(e){let t=await this.ensureDB();return new Promise((r,a)=>{let n=t.transaction([e],"readwrite").objectStore(e).clear();n.onerror=()=>a(n.error),n.onsuccess=()=>r()})}async getByIndex(e,t,r){let a=await this.ensureDB();return new Promise((n,o)=>{let s=a.transaction([e],"readonly").objectStore(e).index(t).getAll(r);s.onerror=()=>o(s.error),s.onsuccess=()=>n(s.result)})}constructor(){this.db=null}}let s=new o,i={async init(){await s.init()},async getAll(){try{return await s.getAll(a.WORKS)}catch(e){return console.error("讀取作品數據失敗:",e),[]}},async setAll(e){try{for(let t of(await s.clear(a.WORKS),e))await s.put(a.WORKS,t)}catch(e){console.error("儲存作品數據失敗:",e)}},async findByTitle(e){try{return(await s.getByIndex(a.WORKS,"title",e)).find(t=>t.title===e)||null}catch(e){return console.error("查找作品失敗:",e),null}},async findByAniListId(e){try{return(await this.getAll()).find(t=>t.note&&t.note.includes("AniList ID: ".concat(e)))||null}catch(e){return console.error("查找 AniList 作品失敗:",e),null}},async create(e){var t;let r={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),...e,reminder_enabled:null!==(t=e.reminder_enabled)&&void 0!==t&&t,date_added:n(),date_updated:void 0,tags:[],episodes:e.episodes||[]};try{return await s.add(a.WORKS,r),r}catch(e){throw console.error("新增作品失敗:",e),e}},async update(e,t){try{let r=await s.get(a.WORKS,e);if(!r)return null;let o={...r,...t,date_updated:n()};return await s.put(a.WORKS,o),o}catch(e){return console.error("更新作品失敗:",e),null}},async delete(e){try{return await s.delete(a.WORKS,e),!0}catch(e){return console.error("刪除作品失敗:",e),!1}},async getList(e){try{let t=await this.getAll();(null==e?void 0:e.title)&&(t=t.filter(t=>t.title.toLowerCase().includes(e.title.toLowerCase()))),(null==e?void 0:e.type)&&(t=t.filter(t=>t.type===e.type)),(null==e?void 0:e.status)&&(t=t.filter(t=>t.status===e.status)),(null==e?void 0:e.year)&&(t=t.filter(t=>t.year===e.year)),(null==e?void 0:e.tag_ids)&&e.tag_ids.length>0&&(t=t.filter(t=>t.tags.some(t=>e.tag_ids.includes(t.id))));let r=(null==e?void 0:e.page)||1,a=(null==e?void 0:e.size)||20,n=(r-1)*a;return{works:t.slice(n,n+a),total:t.length,page:r,size:a}}catch(e){return console.error("取得作品列表失敗:",e),{works:[],total:0,page:1,size:20}}},async getStats(){try{let e=await this.getAll(),t={};e.forEach(e=>{t[e.type]=(t[e.type]||0)+1});let r={};e.forEach(e=>{r[e.status]=(r[e.status]||0)+1});let a={};e.forEach(e=>{var t;let r=(null===(t=e.year)||void 0===t?void 0:t.toString())||"未知";a[r]=(a[r]||0)+1});let n=0,o=0;e.forEach(e=>{e.episodes&&(n+=e.episodes.length,o+=e.episodes.filter(e=>e.watched).length)});let s=n>0?Math.round(o/n*100):0;return{total_works:e.length,type_stats:t,status_stats:r,year_stats:a,episode_stats:{total_episodes:n,watched_episodes:o,completion_rate:s}}}catch(e){return console.error("取得統計數據失敗:",e),{total_works:0,type_stats:{},status_stats:{},year_stats:{},episode_stats:{total_episodes:0,watched_episodes:0,completion_rate:0}}}}},c={async init(){await s.init()},async getAll(){try{return await s.getAll(a.TAGS)}catch(e){return console.error("讀取標籤數據失敗:",e),[]}},async setAll(e){try{for(let t of(await s.clear(a.TAGS),e))await s.put(a.TAGS,t)}catch(e){console.error("儲存標籤數據失敗:",e)}},async create(e){try{let t=await this.getAll(),r={id:Math.max(0,...t.map(e=>e.id))+1,...e};return await s.add(a.TAGS,r),r}catch(e){throw console.error("新增標籤失敗:",e),e}},async update(e,t){try{let r=await s.get(a.TAGS,e);if(!r)return null;let n={...r,...t};return await s.put(a.TAGS,n),n}catch(e){return console.error("更新標籤失敗:",e),null}},async delete(e){try{return await s.delete(a.TAGS,e),!0}catch(e){return console.error("刪除標籤失敗:",e),!1}}},l=async()=>{try{await s.init();let e=await i.getAll(),t=await c.getAll();0===e.length&&(await i.create({title:"進擊的巨人",type:"動畫",status:"已完結",year:2013,rating:5,review:"經典神作！劇情緊湊，角色塑造深刻，音樂震撼人心。",source:"AniList",episodes:[{id:"ep-1",number:1,title:"致2000年後的你",description:"艾連\xb7葉卡在夢中看到未來",type:"episode",season:1,watched:!0,date_watched:"2023-01-15T00:00:00.000Z"},{id:"ep-2",number:2,title:"那一天",description:"巨人入侵希干希納區",type:"episode",season:1,watched:!0,date_watched:"2023-01-15T00:00:00.000Z"},{id:"ep-special",number:1,title:"無悔的選擇",description:"里維兵長的外傳",type:"special",season:1,watched:!1}]}),await i.create({title:"星際效應",type:"電影",status:"已完結",year:2014,rating:5,review:"諾蘭的科幻傑作，結合了硬科幻與人文情感，視覺效果震撼。",source:"手動新增",episodes:[{id:"movie-1",number:1,title:"星際效應",description:"人類為了尋找新的家園而展開的星際旅程",type:"movie",season:1,watched:!0,date_watched:"2023-02-10T00:00:00.000Z"}]}),await i.create({title:"權力遊戲",type:"電視劇",status:"已完結",year:2011,rating:4,review:"史詩級奇幻劇集，政治鬥爭與奇幻元素完美結合。",source:"手動新增",episodes:[{id:"ep-1",number:1,title:"凜冬將至",description:"史塔克家族發現冰原狼幼崽",type:"episode",season:1,watched:!0,date_watched:"2023-03-05T00:00:00.000Z"},{id:"ep-2",number:2,title:"國王大道",description:"艾德\xb7史塔克前往君臨城",type:"episode",season:1,watched:!0,date_watched:"2023-03-05T00:00:00.000Z"},{id:"ep-3",number:3,title:"雪諾，私生子",description:"瓊恩\xb7雪諾加入守夜人",type:"episode",season:1,watched:!1}]}),await i.create({title:"哈利波特與魔法石",type:"小說",status:"已完結",year:1997,rating:5,review:"魔法世界的開始，J.K.羅琳的奇幻傑作。",source:"手動新增",episodes:[{id:"ch-1",number:1,title:"活下來的男孩",description:"哈利波特被送到德思禮家",type:"chapter",season:1,watched:!0,date_watched:"2023-03-01T00:00:00.000Z"},{id:"ch-2",number:2,title:"消失的玻璃",description:"哈利發現自己的魔法能力",type:"chapter",season:1,watched:!0,date_watched:"2023-03-01T00:00:00.000Z"},{id:"ch-3",number:3,title:"來自霍格華茲的信",description:"哈利收到霍格華茲的入學通知",type:"chapter",season:1,watched:!1}]}),await i.create({title:"鬼滅之刃",type:"漫畫",status:"進行中",year:2016,rating:4,review:"熱血戰鬥漫畫，畫風精美，劇情緊湊。",source:"手動新增",episodes:[{id:"ch-1",number:1,title:"殘酷",description:"竈門炭治郎的家人被鬼襲擊",type:"chapter",season:1,watched:!0,date_watched:"2023-04-01T00:00:00.000Z"},{id:"ch-2",number:2,title:"培育者 鱗瀧左近次",description:"炭治郎開始學習呼吸法",type:"chapter",season:1,watched:!0,date_watched:"2023-04-01T00:00:00.000Z"},{id:"ch-3",number:3,title:"鬼舞辻無慘",description:"炭治郎遇到鬼舞辻無慘",type:"chapter",season:1,watched:!1}]})),0===t.length&&(await c.create({name:"神作",color:"#FF6B6B"}),await c.create({name:"熱血",color:"#4ECDC4"}),await c.create({name:"劇情",color:"#45B7D1"}),await c.create({name:"魔法",color:"#96CEB4"}),await c.create({name:"冒險",color:"#FFEAA7"}),await c.create({name:"科幻",color:"#A8E6CF"}),await c.create({name:"奇幻",color:"#FFB3BA"}),await c.create({name:"動作",color:"#FFD93D"}))}catch(e){console.error("初始化示例數據失敗:",e)}},d={async clearAll(){try{await s.clear(a.WORKS),await s.clear(a.TAGS)}catch(e){console.error("清空數據失敗:",e)}},async exportData(){try{let e=await i.getAll(),t=await c.getAll();return{works:e,tags:t}}catch(e){return console.error("匯出數據失敗:",e),{works:[],tags:[]}}},async importData(e){try{await i.setAll(e.works),await c.setAll(e.tags)}catch(e){console.error("匯入數據失敗:",e)}},async getDatabaseInfo(){try{let e=await i.getAll(),t=await c.getAll();return{worksCount:e.length,tagsCount:t.length}}catch(e){return console.error("取得資料庫信息失敗:",e),{worksCount:0,tagsCount:0}}}}},2169:function(e,t,r){r.d(t,{a:function(){return s},cn:function(){return o}});var a=r(7042),n=r(4769);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}function s(e){return"".concat("/WatchedIt").concat(e)}}}]);