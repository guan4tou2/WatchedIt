(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{8203:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,l(2898).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},6245:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,l(2898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},2245:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,l(2898).Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]])},3673:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,l(2898).Z)("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]])},2549:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,l(2898).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},1786:function(e,s,l){Promise.resolve().then(l.bind(l,9253))},9253:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return w}});var t=l(7437),a=l(2265),i=l(4033),r=l(5671),n=l(575),c=l(3277),d=l(3536),o=l(170),x=l(2782),m=l(3181),h=l(2245),u=l(6245),j=l(2549);function p(e){let{work:s,onSave:l,onCancel:i,isOpen:c,inline:o=!1}=e,{tags:p}=(0,d.B)(),[v,f]=(0,a.useState)({title:s.title,type:s.type,status:s.status,year:s.year||"",rating:s.rating||"",review:s.review||"",note:s.note||"",source:s.source||""}),[N,g]=(0,a.useState)(s.tags||[]);(0,a.useEffect)(()=>{f({title:s.title,type:s.type,status:s.status,year:s.year||"",rating:s.rating||"",review:s.review||"",note:s.note||"",source:s.source||""}),g(s.tags||[])},[s]);let b=e=>{f({...v,rating:v.rating===e.toString()?"":e.toString()})};if(!c)return null;let y=(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l({title:v.title,type:v.type,status:v.status,year:v.year?parseInt(v.year.toString()):void 0,rating:v.rating?parseInt(v.rating.toString()):void 0,review:v.review||void 0,note:v.note||void 0,source:v.source||void 0,tags:N})},className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"標題"}),(0,t.jsx)(x.I,{value:v.title,onChange:e=>f({...v,title:e.target.value}),placeholder:"作品標題",required:!0,className:"mt-1"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"類型"}),(0,t.jsxs)("select",{value:v.type,onChange:e=>f({...v,type:e.target.value}),className:"w-full mt-1 p-2 border rounded-md form-select",required:!0,children:[(0,t.jsx)("option",{value:"動畫",children:"動畫"}),(0,t.jsx)("option",{value:"電影",children:"電影"}),(0,t.jsx)("option",{value:"電視劇",children:"電視劇"}),(0,t.jsx)("option",{value:"小說",children:"小說"}),(0,t.jsx)("option",{value:"漫畫",children:"漫畫"}),(0,t.jsx)("option",{value:"遊戲",children:"遊戲"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"狀態"}),(0,t.jsxs)("select",{value:v.status,onChange:e=>f({...v,status:e.target.value}),className:"w-full mt-1 p-2 border rounded-md form-select",required:!0,children:[(0,t.jsx)("option",{value:"進行中",children:"進行中"}),(0,t.jsx)("option",{value:"已完結",children:"已完結"}),(0,t.jsx)("option",{value:"暫停",children:"暫停"}),(0,t.jsx)("option",{value:"放棄",children:"放棄"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"年份"}),(0,t.jsx)(x.I,{type:"number",value:v.year,onChange:e=>f({...v,year:e.target.value}),placeholder:"2023",min:"1900",max:"2030",className:"mt-1"})]})]}),(0,t.jsx)(m.Z,{availableTags:p,selectedTags:N,onTagsChange:g}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"評分"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[[1,2,3,4,5].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>b(e),className:"p-2 rounded-md transition-colors ".concat(parseInt(String(v.rating||"0"))>=e?"star-icon bg-yellow-50 dark:bg-yellow-900/20":"star-icon-unselected"),children:(0,t.jsx)(h.Z,{className:"w-5 h-5",fill:parseInt(String(v.rating||"0"))>=e?"currentColor":"none"})},e)),v.rating&&(0,t.jsxs)("span",{className:"text-sm description-text ml-2",children:[v.rating,"/5"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"評論"}),(0,t.jsx)("textarea",{value:v.review,onChange:e=>f({...v,review:e.target.value}),placeholder:"分享您的觀後感...",rows:3,className:"w-full mt-1 p-2 border rounded-md resize-none form-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"備註"}),(0,t.jsx)("textarea",{value:v.note,onChange:e=>f({...v,note:e.target.value}),placeholder:"其他備註...",rows:2,className:"w-full mt-1 p-2 border rounded-md resize-none form-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"來源"}),(0,t.jsx)(x.I,{value:v.source,onChange:e=>f({...v,source:e.target.value}),placeholder:"作品來源",className:"mt-1"})]}),(0,t.jsxs)("div",{className:"flex space-x-2 pt-4",children:[(0,t.jsxs)(n.z,{type:"submit",className:"flex-1",children:[(0,t.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"儲存"]}),(0,t.jsxs)(n.z,{type:"button",variant:"outline",onClick:i,className:"flex-1",children:[(0,t.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"取消"]})]})]});return o?y:(0,t.jsxs)(r.Zb,{children:[(0,t.jsx)(r.Ol,{children:(0,t.jsx)(r.ll,{children:"編輯作品"})}),(0,t.jsx)(r.aY,{children:y})]})}var v=l(2169),f=l(3067),N=l(1138),g=l(9617),b=l(8203),y=l(3673);function w(){let e=(0,i.useRouter)(),s=(0,i.useSearchParams)(),{getWork:l,updateWork:x,deleteWork:m,loading:h}=(0,d.B)(),[u,j]=(0,a.useState)(null),[w,k]=(0,a.useState)(!1),[Z,C]=(0,a.useState)(!1),[S,z]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{let e=null==s?void 0:s.get("id");if(e){z(!0);try{let s=await l(e);j(s)}catch(e){console.error("載入作品失敗:",e)}finally{z(!1)}}})()},[s,l]);let _=async()=>{u&&confirm("確定要刪除這個作品嗎？")&&(await m(u.id),e.push((0,v.a)("/")))};if(h||S)return(0,t.jsx)("div",{className:"container mx-auto p-4 sm:p-6",children:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:"載入中..."})]})})});if(!u)return(0,t.jsx)("div",{className:"container mx-auto p-4 sm:p-6",children:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"作品不存在"}),(0,t.jsxs)(n.z,{variant:"outline",onClick:()=>e.push((0,v.a)("/")),children:[(0,t.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"返回首頁"]})]})})});let D=u.episodes||[],O=D.filter(e=>e.watched).length,I=D.length;return(0,t.jsxs)("div",{className:"container mx-auto p-4 sm:p-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>e.back(),children:[(0,t.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"返回"]}),(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:u.title})]}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsxs)(n.z,{variant:"outline",size:"sm",onClick:_,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300",children:[(0,t.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"刪除"]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-4 sm:space-y-6",children:[(0,t.jsxs)(r.Zb,{children:[(0,t.jsx)(r.Ol,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-2 sm:space-y-0",children:[(0,t.jsx)(r.ll,{children:"基本資訊"}),(0,t.jsxs)(n.z,{variant:"outline",size:"sm",onClick:()=>C(!Z),children:[(0,t.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),Z?"取消編輯":"編輯作品"]})]})}),(0,t.jsxs)(r.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"類型"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)(c.C,{variant:"secondary",children:u.type})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"狀態"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)(c.C,{variant:"已完結"===u.status?"default":"進行中"===u.status?"secondary":"outline",children:u.status})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"年份"}),(0,t.jsx)("p",{className:"mt-1 title-text",children:u.year||"未知"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"評分"}),(0,t.jsx)("p",{className:"mt-1 title-text",children:u.rating?"".concat(u.rating,"/5"):"未評分"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"form-label flex items-center",children:[(0,t.jsx)(b.Z,{className:"w-4 h-4 mr-1"}),"新增時間"]}),(0,t.jsx)("p",{className:"mt-1 title-text",children:new Date(u.date_added).toLocaleDateString("zh-TW")})]}),u.date_updated&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"更新時間"}),(0,t.jsx)("p",{className:"mt-1 title-text",children:new Date(u.date_updated).toLocaleDateString("zh-TW")})]})]}),u.review&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"評論"}),(0,t.jsx)("p",{className:"mt-1 description-text",children:u.review})]}),u.note&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"備註"}),(0,t.jsx)("p",{className:"mt-1 description-text",children:u.note})]}),u.source&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"來源"}),(0,t.jsx)("p",{className:"mt-1 description-text",children:u.source})]}),u.tags&&u.tags.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 flex items-center",children:[(0,t.jsx)(y.Z,{className:"w-4 h-4 mr-1"}),"標籤"]}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:u.tags.map(e=>(0,t.jsx)(c.C,{children:e.name},e.id))})]}),Z&&u&&(0,t.jsx)("div",{className:"mt-6 p-4 border-2 border-dashed border-blue-200 dark:border-blue-800 rounded-lg",children:(0,t.jsx)(p,{work:u,onSave:e=>{u&&(j({...u,...e,date_updated:new Date().toISOString()}),x(u.id,e),C(!1))},onCancel:()=>C(!1),isOpen:!0,inline:!0})})]})]}),(0,t.jsx)(o.Z,{episodes:D,onEpisodesChange:e=>{if(u)try{console.log("處理集數變更:",e);let s={...u,episodes:e,date_updated:new Date().toISOString()};console.log("更新作品:",s),j(s),x(u.id,{episodes:e})}catch(e){console.error("處理集數變更失敗:",e)}},type:u.type,disabled:!1,isEditing:w,onToggleEditing:()=>k(!w)})]}),(0,t.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)(r.Zb,{children:[(0,t.jsx)(r.Ol,{children:(0,t.jsx)(r.ll,{children:"集數統計"})}),(0,t.jsxs)(r.aY,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-semibold title-text",children:I}),(0,t.jsx)("div",{className:"description-text",children:"總集數"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-semibold title-text",children:O}),(0,t.jsx)("div",{className:"description-text",children:"季數"})]})]}),D.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium title-text",children:"集數類型"}),(0,t.jsx)("div",{className:"space-y-1",children:Object.entries(D.reduce((e,s)=>(e[s.type]=(e[s.type]||0)+1,e),{})).map(e=>{let[s,l]=e;return(0,t.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,t.jsx)("span",{className:"capitalize subtitle-text",children:s}),(0,t.jsx)("span",{className:"title-text",children:l})]},s)})})]})]})]}),(0,t.jsxs)(r.Zb,{children:[(0,t.jsx)(r.Ol,{children:(0,t.jsx)(r.ll,{children:"時間資訊"})}),(0,t.jsxs)(r.aY,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm description-text",children:"新增時間"}),(0,t.jsx)("span",{className:"text-sm title-text",children:new Date(u.date_added).toLocaleDateString("zh-TW")})]}),u.date_updated&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm description-text",children:"更新時間"}),(0,t.jsx)("span",{className:"text-sm title-text",children:new Date(u.date_updated).toLocaleDateString("zh-TW")})]})]})]})]})]})]})}},3181:function(e,s,l){"use strict";l.d(s,{Z:function(){return d}});var t=l(7437),a=l(2265),i=l(3277),r=l(575),n=l(2549),c=l(9883);function d(e){let{availableTags:s,selectedTags:l,onTagsChange:d,disabled:o=!1}=e,[x,m]=(0,a.useState)(!1),h=e=>{l.some(s=>s.id===e.id)?d(l.filter(s=>s.id!==e.id)):d([...l,e])},u=e=>{d(l.filter(s=>s.id!==e))},j=s.filter(e=>!l.some(s=>s.id===e.id));return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"form-label",children:"標籤"}),l.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(e=>(0,t.jsxs)(i.C,{className:"flex items-center space-x-1",children:[(0,t.jsx)("span",{children:e.name}),!o&&(0,t.jsx)("button",{onClick:()=>u(e.id),className:"ml-1 hover:bg-black hover:bg-opacity-10 rounded-full p-0.5",children:(0,t.jsx)(n.Z,{className:"w-3 h-3"})})]},e.id))}),!o&&(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)(r.z,{type:"button",variant:"outline",size:"sm",onClick:()=>m(!x),className:"w-full justify-start",children:[(0,t.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),0===l.length?"選擇標籤":"管理標籤"]}),x&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dropdown-bg border rounded-md shadow-lg z-10 max-h-48 overflow-y-auto",children:0===j.length?(0,t.jsx)("div",{className:"p-3 text-sm empty-state text-center",children:"所有標籤都已選擇"}):(0,t.jsx)("div",{className:"p-2 space-y-1",children:j.map(e=>(0,t.jsxs)("button",{onClick:()=>h(e),className:"w-full text-left p-2 hover:bg-gray-50 hover-bg rounded flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded border"}),(0,t.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})})]}),x&&(0,t.jsx)("div",{className:"fixed inset-0 z-0",onClick:()=>m(!1)})]})}}},function(e){e.O(0,[621,330,262,170,971,458,744],function(){return e(e.s=1786)}),_N_E=e.O()}]);