"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[854],{5343:function(e,t,i){i.d(t,{Z:function(){return c}});var r=i(7437),n=i(1396),s=i.n(n),a=i(9670),o=i(2169);function c(e){let{className:t="",showText:i=!0}=e;return(0,r.jsxs)(s(),{href:(0,o.a)("/"),className:"flex items-center space-x-2 ".concat(t),children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-primary rounded-lg",children:(0,r.jsx)(a.Z,{className:"w-5 h-5 text-primary-foreground"})}),i&&(0,r.jsx)("span",{className:"text-xl font-bold text-foreground",children:"WatchedIt"})]})}},3397:function(e,t,i){i.r(t),i.d(t,{ThemeProvider:function(){return a},useTheme:function(){return o}});var r=i(7437),n=i(2265);let s=(0,n.createContext)(void 0);function a(e){let{children:t,defaultTheme:i="auto"}=e,[a,o]=(0,n.useState)(i),[c,l]=(0,n.useState)("light"),[d,u]=(0,n.useState)("light"),[g,h]=(0,n.useState)(!1),p=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";return((0,n.useEffect)(()=>{h(!0);let e=localStorage.getItem("watchedit_theme");e&&o(e),u(p())},[]),(0,n.useEffect)(()=>{let e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{let t=e.matches?"dark":"light";u(t),"auto"===a&&l(t)};return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[a]),(0,n.useEffect)(()=>{let e;if(!g)return;localStorage.setItem("watchedit_theme",a),l(e="auto"===a?d:a);let t=document.documentElement;t.classList.remove("light","dark"),t.classList.add(e);let i=document.querySelector('meta[name="theme-color"]');i&&i.setAttribute("content","dark"===e?"#1f2937":"#3b82f6")},[a,d,g]),g)?(0,r.jsx)(s.Provider,{value:{theme:a,setTheme:o,resolvedTheme:g?c:"light",systemTheme:g?d:"light"},children:t}):null}function o(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},5125:function(e,t,i){i.d(t,{a:function(){return n}});class r{getDeviceId(){let e=localStorage.getItem("watchedit_device_id");return e||(e="device_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("watchedit_device_id",e)),e}setConfig(e){this.config=e,localStorage.setItem("watchedit_cloud_config",JSON.stringify(e))}getConfig(){if(!this.config){let e=localStorage.getItem("watchedit_cloud_config");e&&(this.config=JSON.parse(e))}return this.config}async testConnection(e){try{let t=await fetch("".concat(e,"/health"),{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok)return{success:!0,message:"雲端連接測試成功"};return{success:!1,message:"雲端連接失敗",error:"HTTP ".concat(t.status,": ").concat(t.statusText)}}catch(e){return{success:!1,message:"雲端連接失敗",error:e instanceof Error?e.message:"未知錯誤"}}}async uploadData(e,t){var i;if(!(null===(i=this.config)||void 0===i?void 0:i.endpoint))return{success:!1,message:"未設定雲端端點",error:"請先在設定中配置雲端端點"};try{let i={works:e,tags:t,backupDate:new Date().toISOString(),version:"1.0.0",deviceId:this.deviceId},r=await fetch("".concat(this.config.endpoint,"/backup"),{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:"Bearer ".concat(this.config.apiKey)}},body:JSON.stringify(i)});if(!r.ok)return{success:!1,message:"數據上傳失敗",error:"HTTP ".concat(r.status,": ").concat(r.statusText)};{let i=await r.json();return{success:!0,message:"數據上傳成功",data:{works:i.works||e,tags:i.tags||t,lastSync:new Date().toISOString()}}}}catch(e){return{success:!1,message:"數據上傳失敗",error:e instanceof Error?e.message:"未知錯誤"}}}async downloadData(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.endpoint))return{success:!1,message:"未設定雲端端點",error:"請先在設定中配置雲端端點"};try{let e=await fetch("".concat(this.config.endpoint,"/backup?device_id=").concat(this.deviceId),{method:"GET",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:"Bearer ".concat(this.config.apiKey)}}});if(!e.ok)return{success:!1,message:"數據下載失敗",error:"HTTP ".concat(e.status,": ").concat(e.statusText)};{let t=await e.json();return{success:!0,message:"數據下載成功",data:{works:t.works||[],tags:t.tags||[],lastSync:new Date().toISOString()}}}}catch(e){return{success:!1,message:"數據下載失敗",error:e instanceof Error?e.message:"未知錯誤"}}}async syncData(e,t){var i;if(!(null===(i=this.config)||void 0===i?void 0:i.endpoint))return{success:!1,message:"未設定雲端端點",error:"請先在設定中配置雲端端點"};try{let i=await this.downloadData();if(!i.success||!i.data)return await this.uploadData(e,t);{let r=this.mergeWorks(e,i.data.works),n=this.mergeTags(t,i.data.tags),s=await this.uploadData(r,n);if(s.success)return{success:!0,message:"數據同步成功",data:{works:r,tags:n,lastSync:new Date().toISOString()}};return s}}catch(e){return{success:!1,message:"數據同步失敗",error:e instanceof Error?e.message:"未知錯誤"}}}mergeWorks(e,t){let i=[...e],r=new Set(e.map(e=>e.id));for(let n of t)if(r.has(n.id)){let t=e.find(e=>e.id===n.id);if(t&&n.date_updated&&t.date_updated&&new Date(n.date_updated)>new Date(t.date_updated)){let e=i.findIndex(e=>e.id===n.id);-1!==e&&(i[e]=n)}}else i.push(n);return i}mergeTags(e,t){let i=[...e],r=new Set(e.map(e=>e.id));for(let e of t)r.has(e.id)||i.push(e);return i}getLastSyncTime(){return localStorage.getItem("watchedit_last_sync")}setLastSyncTime(){localStorage.setItem("watchedit_last_sync",new Date().toISOString())}shouldSync(){let e=this.getLastSyncTime();if(!e)return!0;let t=new Date(e);return(new Date().getTime()-t.getTime())/36e5>1}clearConfig(){this.config=null,localStorage.removeItem("watchedit_cloud_config"),localStorage.removeItem("watchedit_last_sync")}constructor(){this.config=null,this.deviceId=this.getDeviceId()}}let n=new r},6096:function(e,t,i){i.d(t,{e:function(){return s}});var r=i(4494);let n="watchedit_custom_episode_types",s={getAll(){try{let e=localStorage.getItem(n);if(e)return JSON.parse(e);return this.initializeDefaultTypes(),r.h}catch(e){return console.error("讀取自訂集數類型數據失敗:",e),r.h}},initializeDefaultTypes(){localStorage.setItem(n,JSON.stringify(r.h))},getEnabledTypes(){return this.getAll().filter(e=>e.isEnabled)},getById(e){return this.getAll().find(t=>t.id===e)||null},getByName(e){return this.getAll().find(t=>t.name===e)||null},create(e){let t=this.getAll();if(t.some(t=>t.name===e.name))throw Error("集數類型「".concat(e.name,"」已存在"));let i={...e,id:"custom_".concat(Date.now()),createdAt:new Date().toISOString()};return t.push(i),localStorage.setItem(n,JSON.stringify(t)),i},update(e,t){let i=this.getAll(),r=i.findIndex(t=>t.id===e);if(-1===r)return null;if(t.name&&i.some((e,i)=>i!==r&&e.name===t.name))throw Error("集數類型「".concat(t.name,"」已存在"));return i[r]={...i[r],...t,updatedAt:new Date().toISOString()},localStorage.setItem(n,JSON.stringify(i)),i[r]},delete(e){let t=this.getAll(),i=t.find(t=>t.id===e);if(!i)return!1;if(i.isDefault)throw Error("無法刪除預設的集數類型");let r=t.filter(t=>t.id!==e);return localStorage.setItem(n,JSON.stringify(r)),!0},toggleEnabled(e){let t=this.getById(e);return t?this.update(e,{isEnabled:!t.isEnabled}):null},resetToDefault(){this.initializeDefaultTypes()},isNameDuplicate(e,t){return this.getAll().some(i=>i.name===e&&i.id!==t)},getTypeNames(){return this.getEnabledTypes().map(e=>e.name)},getTypeLabels(){let e={};return this.getEnabledTypes().forEach(t=>{e[t.name]=t.label}),e}}},954:function(e,t,i){i.d(t,{O:function(){return n}});class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}async registerServiceWorker(){if("serviceWorker"in navigator)try{this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered successfully:",this.registration)}catch(e){console.error("Service Worker registration failed:",e)}}async requestNotificationPermission(){return"Notification"in window?"granted"===Notification.permission||("denied"===Notification.permission?(console.log("Notification permission denied"),!1):"granted"===await Notification.requestPermission()):(console.log("This browser does not support notifications"),!1)}async sendNotification(e,t){"Notification"in window&&("granted"===Notification.permission?new Notification(e,{icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png",...t}):"denied"!==Notification.permission&&"granted"===await Notification.requestPermission()&&new Notification(e,{icon:"/icons/icon-192x192.png",badge:"/icons/icon-72x72.png",...t}))}isPWA(){return window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}isAndroid(){return/Android/.test(navigator.userAgent)}isDesktop(){return!this.isMobile()}getPlatformInfo(){return{isPWA:this.isPWA(),isMobile:this.isMobile(),isIOS:this.isIOS(),isAndroid:this.isAndroid(),isDesktop:this.isDesktop(),userAgent:navigator.userAgent}}async backgroundSync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"background-sync";if(this.registration&&"sync"in this.registration)try{await this.registration.sync.register(e),console.log("Background sync registered")}catch(e){console.error("Background sync registration failed:",e)}}async checkForUpdate(){return!!this.registration&&(await this.registration.update(),!0)}constructor(){this.registration=null}}let n=r.getInstance()},4222:function(e,t,i){i.d(t,{u:function(){return s}});var r=i(4494);let n="watchedit_work_type_episode_mapping",s={getAll(){try{let e=localStorage.getItem(n);if(e)return JSON.parse(e);return this.initializeDefaultMapping(),r.n}catch(e){return console.error("讀取作品類型與集數類型對應數據失敗:",e),r.n}},initializeDefaultMapping(){localStorage.setItem(n,JSON.stringify(r.n))},getEpisodeTypesForWorkType(e){let t=this.getAll().find(t=>t.workType===e);return(null==t?void 0:t.episodeTypes)||["episode"]},getDefaultEpisodeTypeForWorkType(e){let t=this.getAll().find(t=>t.workType===e);return(null==t?void 0:t.defaultEpisodeType)||"episode"},create(e){let t=this.getAll();if(-1!==t.findIndex(t=>t.workType===e.workType))throw Error("作品類型「".concat(e.workType,"」的對應關係已存在"));return t.push(e),localStorage.setItem(n,JSON.stringify(t)),e},update(e,t){let i=this.getAll(),r=i.findIndex(t=>t.workType===e);return -1===r?null:(i[r]={...i[r],...t},localStorage.setItem(n,JSON.stringify(i)),i[r])},delete(e){let t=this.getAll(),i=t.filter(t=>t.workType!==e);return i.length!==t.length&&(localStorage.setItem(n,JSON.stringify(i)),!0)},resetToDefault(){localStorage.setItem(n,JSON.stringify(r.n))},hasMapping(e){return this.getAll().some(t=>t.workType===e)},getWorkTypes(){return this.getAll().map(e=>e.workType)},getByWorkType(e){return this.getAll().find(t=>t.workType===e)||null}}},4494:function(e,t,i){i.d(t,{h:function(){return r},n:function(){return n}});let r=[{id:"episode",name:"episode",label:"正篇",color:"#3B82F6",icon:"\uD83D\uDCFA",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"special",name:"special",label:"特別篇",color:"#10B981",icon:"\uD83C\uDFAC",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"ova",name:"ova",label:"OVA",color:"#F59E0B",icon:"\uD83C\uDFAD",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"movie",name:"movie",label:"電影",color:"#EF4444",icon:"\uD83C\uDF9E️",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()},{id:"chapter",name:"chapter",label:"章節",color:"#8B5CF6",icon:"\uD83D\uDCD6",isDefault:!0,isEnabled:!0,createdAt:new Date().toISOString()}],n=[{workType:"動畫",episodeTypes:["episode","special","ova","movie"],defaultEpisodeType:"episode"},{workType:"電影",episodeTypes:["movie"],defaultEpisodeType:"movie"},{workType:"電視劇",episodeTypes:["episode","special"],defaultEpisodeType:"episode"},{workType:"小說",episodeTypes:["chapter"],defaultEpisodeType:"chapter"},{workType:"漫畫",episodeTypes:["chapter"],defaultEpisodeType:"chapter"},{workType:"遊戲",episodeTypes:["episode","special"],defaultEpisodeType:"episode"}]}}]);