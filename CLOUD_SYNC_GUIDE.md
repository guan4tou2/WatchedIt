# 雲端同步功能使用指南

## 概述

WatchedIt 現在支援雲端同步功能，可以將您的作品和標籤數據備份到雲端，並在多個設備間同步。

## 功能特色

- 🔄 **雙向同步**: 本地和雲端數據自動合併
- 📱 **多設備支援**: 在不同設備間同步數據
- 🔒 **安全備份**: 數據加密傳輸和儲存
- ⏰ **自動同步**: 可設定自動同步間隔
- 📊 **同步狀態**: 即時顯示同步狀態和最後同步時間

## 設定步驟

### 1. 配置雲端端點

1. 前往「設定」頁面
2. 在「資料管理」區塊中選擇「雲端同步」
3. 輸入您的雲端端點，例如：
   - 本地測試: `http://localhost:8000/cloud`
   - 生產環境: `https://your-server.com/api/cloud`

### 2. 測試連接

1. 點擊「測試連接」按鈕
2. 確認連接成功後，您就可以開始使用雲端功能

### 3. 首次同步

1. 點擊「同步到雲端」將本地數據上傳
2. 或點擊「從雲端下載」下載雲端數據

## 同步機制

### 數據合併規則

- **作品合併**: 根據作品 ID 和更新時間進行智能合併
- **標籤合併**: 根據標籤 ID 進行合併，避免重複
- **衝突解決**: 以最新更新的版本為準

### 同步頻率

- **手動同步**: 隨時可以手動觸發同步
- **自動同步**: 可設定每 1-1440 分鐘自動同步一次
- **建議同步**: 系統會提醒您何時需要同步

## 使用場景

### 場景 1: 多設備使用

1. 在手機上新增作品和標籤
2. 同步到雲端
3. 在電腦上打開應用，從雲端下載
4. 所有數據自動合併

### 場景 2: 數據備份

1. 定期同步到雲端
2. 如果本地數據丟失，可以從雲端恢復
3. 支援多個備份版本

### 場景 3: 團隊協作

1. 多人使用同一個雲端端點
2. 每個人的數據會自動合併
3. 可以共享作品和標籤

## 後端 API 規格

### 健康檢查
```
GET /cloud/health
```

### 上傳備份
```
POST /cloud/backup
Content-Type: application/json

{
  "works": [...],
  "tags": [...],
  "backupDate": "2024-01-01T00:00:00Z",
  "version": "1.0.0",
  "deviceId": "device_123"
}
```

### 下載備份
```
GET /cloud/backup?device_id=device_123
```

### 刪除備份
```
DELETE /cloud/backup?device_id=device_123
```

## 安全注意事項

1. **API 金鑰**: 建議設定 API 金鑰以保護數據
2. **HTTPS**: 生產環境請使用 HTTPS
3. **備份**: 定期備份雲端數據
4. **權限**: 確保只有授權用戶可以訪問

## 故障排除

### 常見問題

**Q: 同步失敗怎麼辦？**
A: 檢查網路連接和雲端端點是否正確，查看錯誤訊息

**Q: 數據衝突如何解決？**
A: 系統會自動以最新更新的版本為準

**Q: 可以同時使用本地和雲端嗎？**
A: 可以，系統會自動合併數據

**Q: 如何清除雲端數據？**
A: 在設定中清除雲端配置，或使用 API 刪除備份

### 錯誤代碼

- `400`: 請求格式錯誤
- `401`: 未授權（需要 API 金鑰）
- `404`: 雲端端點不存在
- `500`: 伺服器內部錯誤

## 開發者資訊

### 本地測試

1. 啟動後端服務：
```bash
cd backend
uv run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

2. 設定前端雲端端點：
```
http://localhost:8000/cloud
```

### 自建後端

參考 `backend/app/api/cloud.py` 實作您的雲端 API。

## 更新日誌

### v1.0.0
- ✅ 基礎雲端同步功能
- ✅ 雙向數據合併
- ✅ 自動同步提醒
- ✅ 同步狀態顯示
- ✅ 本地測試 API

### 計劃功能
- [ ] 增量同步
- [ ] 版本控制
- [ ] 衝突解決策略
- [ ] 離線同步
- [ ] 多用戶權限管理 